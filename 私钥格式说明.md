# 🔑 TRON 私钥格式说明

## 为什么提示"私钥无效"？

系统验证私钥时，要求私钥必须是 **64位十六进制字符串**。

---

## ✅ 正确的私钥格式

### 格式要求

1. **长度**: 必须是 64 个字符
2. **字符**: 只能包含 0-9 和 a-f (或 A-F)
3. **格式**: 纯十六进制字符串，不包含任何前缀或空格

### 正确示例

```
✅ 正确格式 1:
a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456

✅ 正确格式 2:
A1B2C3D4E5F6789012345678901234567890ABCDEF1234567890ABCDEF123456

✅ 正确格式 3:
0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
```

### 错误示例

```
❌ 错误 1: 包含 0x 前缀
0xa1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456

❌ 错误 2: 长度不足 64 位
a1b2c3d4e5f6789012345678901234567890abcdef

❌ 错误 3: 包含非十六进制字符
a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef12345g

❌ 错误 4: 包含空格
a1b2c3d4 e5f6789012345678901234567890abcdef1234567890abcdef123456

❌ 错误 5: 包含换行符
a1b2c3d4e5f6789012345678901234567890abcdef
1234567890abcdef123456
```

---

## 🔍 如何获取正确格式的私钥？

### 方法 1: 从 TronLink 钱包导出

1. 打开 TronLink 浏览器扩展
2. 点击右上角菜单 → 设置
3. 选择"导出私钥"
4. 输入密码
5. 复制显示的私钥（64位十六进制）

**注意**: 如果私钥有 `0x` 前缀，请删除前缀。

### 方法 2: 从其他钱包导出

大多数 TRON 钱包都支持导出私钥：
- TronLink
- imToken
- Trust Wallet
- Ledger (需要特殊工具)

导出后确保：
- ✅ 长度是 64 个字符
- ✅ 只包含 0-9 和 a-f
- ✅ 没有 0x 前缀
- ✅ 没有空格或换行

### 方法 3: 创建新钱包

如果您需要创建新钱包，可以使用：

```javascript
// 使用 TronWeb 创建新钱包
const TronWeb = require('tronweb');
const account = TronWeb.utils.accounts.generateAccount();

console.log('私钥:', account.privateKey);
console.log('地址:', account.address.base58);
```

---

## 🛠️ 验证私钥格式

### 在线验证

在钱包配置页面：
1. 输入私钥
2. 点击"验证私钥"按钮
3. 系统会显示：
   - ✅ 格式正确 + 钱包地址
   - ❌ 格式错误 + 错误原因

### 手动验证

检查您的私钥：

```javascript
// 正则表达式验证
const hexPattern = /^[0-9a-fA-F]{64}$/;
const isValid = hexPattern.test(yourPrivateKey);

console.log('私钥有效:', isValid);
console.log('私钥长度:', yourPrivateKey.length);
```

---

## 🔧 常见问题修复

### 问题 1: 私钥包含 0x 前缀

**错误**:
```
0xa1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

**修复**: 删除 `0x` 前缀
```
a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

### 问题 2: 私钥包含空格

**错误**:
```
a1b2c3d4 e5f67890 12345678 90123456 7890abcd ef123456 7890abcd ef123456
```

**修复**: 删除所有空格
```
a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

### 问题 3: 私钥包含换行符

**错误**:
```
a1b2c3d4e5f6789012345678901234567890abcdef
1234567890abcdef123456
```

**修复**: 合并为一行
```
a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

### 问题 4: 私钥长度不对

**错误**: 只有 32 个字符
```
a1b2c3d4e5f6789012345678901234567890abcdef
```

**原因**: 这可能是助记词或其他格式

**解决**: 
- 确认您导出的是私钥，不是助记词
- 私钥必须是 64 位十六进制
- 如果是助记词，需要转换为私钥

---

## 🔒 安全提示

### 私钥安全

⚠️ **私钥非常重要，请务必**:
- ✅ 妥善保管，不要泄露
- ✅ 不要通过不安全的渠道传输
- ✅ 定期备份到安全的离线位置
- ✅ 使用专用钱包，不要与个人资产混用

### 验证私钥时

✅ **系统会**:
- 验证格式是否正确
- 尝试生成钱包地址
- 显示钱包地址供您确认

❌ **系统不会**:
- 将私钥发送到前端
- 在日志中输出私钥
- 明文存储私钥（使用 AES-256-GCM 加密）

---

## 📝 验证流程

### 1. 格式验证

```javascript
// 检查长度和字符
const hexPattern = /^[0-9a-fA-F]{64}$/;
if (!hexPattern.test(privateKey)) {
  return '私钥格式错误，必须是64位十六进制字符串';
}
```

### 2. 有效性验证

```javascript
// 尝试创建 TronWeb 实例
const tronWeb = new TronWeb({
  fullHost: 'https://api.trongrid.io',
  privateKey: privateKey
});

// 获取钱包地址
const walletAddress = tronWeb.defaultAddress.base58;
// 如果成功，说明私钥有效
```

### 3. 显示结果

**成功**:
```
✅ 私钥格式正确
钱包地址: TXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**失败**:
```
❌ 私钥格式错误，必须是64位十六进制字符串
```

---

## 🎯 快速检查清单

在输入私钥前，请确认：

- [ ] 私钥长度是 64 个字符
- [ ] 只包含 0-9 和 a-f (或 A-F)
- [ ] 没有 0x 前缀
- [ ] 没有空格
- [ ] 没有换行符
- [ ] 没有其他特殊字符
- [ ] 是从可信钱包导出的

---

## 💡 示例对比

### 正确的私钥

```
长度: 64 字符
格式: 纯十六进制

示例:
1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
│                                                                │
└────────────────────── 64 个字符 ──────────────────────────────┘
```

### 错误的私钥

```
❌ 带前缀:
0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
  ↑ 删除这个

❌ 有空格:
1234567890abcdef 1234567890abcdef 1234567890abcdef 1234567890abcdef
               ↑               ↑               ↑ 删除这些

❌ 太短:
1234567890abcdef1234567890abcdef
│                              │
└──────── 只有 32 字符 ─────────┘
```

---

## 🔧 在线工具

### 验证私钥格式

您可以使用以下在线工具验证私钥格式（**注意安全，不要在不可信网站输入真实私钥**）：

1. **本地验证** (推荐):
   ```javascript
   // 在浏览器控制台运行
   const privateKey = "您的私钥";
   const isValid = /^[0-9a-fA-F]{64}$/.test(privateKey);
   console.log("格式正确:", isValid);
   console.log("长度:", privateKey.length);
   ```

2. **系统验证** (最安全):
   - 在钱包配置页面输入私钥
   - 点击"验证私钥"按钮
   - 查看验证结果

---

## ✅ 总结

### 私钥格式要求

- **长度**: 64 个字符
- **字符**: 0-9, a-f (或 A-F)
- **格式**: 纯十六进制，无前缀，无空格

### 如何获取

1. 从 TronLink 等钱包导出
2. 删除 0x 前缀（如有）
3. 删除空格和换行符
4. 确保长度是 64 位

### 如何验证

1. 在钱包配置页面输入
2. 点击"验证私钥"
3. 查看验证结果和钱包地址

### 安全提示

- 🔒 私钥会被 AES-256-GCM 加密存储
- 🔒 前端永远看不到明文私钥
- 🔒 只在后端解密使用
- 🔒 妥善保管，不要泄露

---

**如果您的私钥格式正确但仍然提示无效，请检查**:
1. 是否复制完整（64位）
2. 是否包含隐藏字符
3. 是否是 TRON 网络的私钥
4. 尝试在 TronLink 中导入验证

---

*文档创建时间: 2026-01-29*
