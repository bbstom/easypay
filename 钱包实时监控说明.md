# 钱包实时监控说明

## 监控数据位置

钱包实时监控数据在以下两个页面显示：

### 1. 财务管理页面 (`/finance`)

在财务管理页面顶部显示钱包状态卡片，包含：

- **钱包地址**: 当前配置的 TRON 钱包地址
- **TRX 余额**: 钱包中的 TRX 余额（用于支付手续费）
- **USDT 余额**: 钱包中的 USDT 余额（用于转账）
- **余额预警**: 当余额低于设定阈值时显示警告

**访问路径**: 管理后台 → 财务管理

### 2. 钱包配置页面 (`/wallet`)

在钱包配置页面顶部显示相同的钱包状态卡片，方便在配置时查看余额。

**访问路径**: 管理后台 → 钱包配置

## 监控数据内容

### 基本信息
- **钱包地址**: 完整的 TRON 钱包地址（显示时会缩短）
- **TRX 余额**: 实时 TRX 余额，精确到小数点后 2 位
- **USDT 余额**: 实时 USDT 余额，精确到小数点后 2 位

### 余额预警

系统会根据配置的阈值自动显示预警：

#### TRX 预警
- **警告级别**: TRX 余额 < 配置的最低余额（默认 50 TRX）
  - 提示: "TRX 余额不足 XX，建议及时充值"
- **危险级别**: TRX 余额 < 20 TRX
  - 提示: "TRX 余额严重不足，可能影响转账"

#### USDT 预警
- **警告级别**: USDT 余额 < 配置的最低余额（默认 100 USDT）
  - 提示: "USDT 余额不足 XX，建议及时充值"

## 数据刷新

### 自动刷新
- 页面加载时自动获取最新数据
- 每次保存配置后自动刷新

### 手动刷新
点击钱包状态卡片右上角的"刷新"按钮可以手动刷新数据。

## API 接口

### 获取钱包状态
```
GET /api/wallet/balance
```

**权限**: 管理员

**返回数据**:
```json
{
  "address": "TP4Cr7xRZ7jGZ5XmKt2aN7NP6yFGG99999",
  "trxBalance": 0.31,
  "usdtBalance": 1.58,
  "ready": false,
  "warnings": [
    {
      "type": "danger",
      "message": "TRX 余额严重不足，可能影响转账"
    },
    {
      "type": "warning",
      "message": "USDT 余额不足 100，建议及时充值"
    }
  ]
}
```

### 获取钱包状态（财务页面）
```
GET /api/payments/wallet/status
```

**权限**: 管理员

**返回数据**: 与上面相同

## 订单统计数据

在财务管理页面还可以看到以下统计数据：

### 待处理订单数
在订单列表中筛选 `transferStatus = 'pending'` 的订单数量

### 处理中订单数
在订单列表中筛选 `transferStatus = 'processing'` 的订单数量

### 查看方式
1. 使用页面顶部的筛选器
2. 选择"转账状态"下拉菜单
3. 选择"待转账"或"处理中"

## 配置余额预警阈值

在钱包配置页面可以设置余额预警阈值：

1. 进入 **钱包配置** 页面
2. 找到 **转账配置** 部分
3. 设置以下参数：
   - **TRX 最低余额预警**: 建议 50 TRX
   - **USDT 最低余额预警**: 建议 100 USDT
4. 点击 **保存配置**

## 故障排查

### 问题：显示"获取钱包状态失败"

**可能原因**:
1. 未配置钱包私钥
2. 私钥配置错误
3. 网络连接问题
4. TRON 节点不可用

**解决方法**:
1. 检查钱包配置是否正确
2. 点击"测试连接"按钮验证配置
3. 检查网络连接
4. 尝试切换 TRON 节点

### 问题：余额显示为 0

**可能原因**:
1. 钱包确实没有余额
2. 查询延迟

**解决方法**:
1. 在区块链浏览器确认余额: https://tronscan.org/
2. 点击"刷新"按钮重新获取
3. 如果确认有余额但显示为 0，请联系技术支持

## 测试脚本

可以使用以下脚本测试钱包状态：

```bash
node server/scripts/testWalletStatus.js
```

输出示例：
```
🔗 连接数据库...
✅ 数据库连接成功

🔄 初始化 TronService...
✅ TronService 初始化成功

🔍 检查钱包状态...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 钱包状态检查成功！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 钱包地址: TP4Cr7xRZ7jGZ5XmKt2aN7NP6yFGG99999
💰 TRX 余额: 0.31 TRX
💵 USDT 余额: 1.58 USDT
✅ 状态: 未就绪
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

*更新时间: 2026-01-29*
