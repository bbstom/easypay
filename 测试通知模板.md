# 测试通知模板

## 已完成的修改

✅ 在 `src/components/TelegramContentEditor.jsx` 中添加了三个通知模板：
1. `payment_success` - 支付成功通知
2. `transfer_complete` - 代付完成通知（新增）
3. `transfer_failed` - 代付失败通知（新增）

✅ 前端已重新编译（`npm run build`）

## 如何使用

### 步骤 1：刷新后台页面
1. 在浏览器中打开后台管理页面
2. 按 `Ctrl + F5` 强制刷新页面（清除缓存）

### 步骤 2：创建通知模板
1. 进入 **Telegram Bot 管理** → **内容管理** 标签页
2. 点击 **"+ 创建内容"** 按钮
3. 点击 **"查看模板"** 按钮
4. 现在你应该能看到以下模板：
   - ✅ 支付成功通知 (`payment_success`)
   - ✅ 代付完成通知 (`transfer_complete`) ← 新增
   - ✅ 代付失败通知 (`transfer_failed`) ← 新增

### 步骤 3：选择并自定义模板
1. 点击任一模板卡片
2. 系统会自动填充模板内容
3. 根据需要修改文本、变量、按钮
4. 点击"保存"

## 模板详情

### 1. payment_success（支付成功通知）
**变量：**
- `{{orderId}}` - 订单号
- `{{totalCNY}}` - 支付金额
- `{{payType}}` - 支付类型（USDT/TRX）

**默认内容：**
```
🎉 支付成功！

━━━━━━━━━━━━━━━
订单号：{{orderId}}
金  额：{{totalCNY}} CNY
━━━━━━━━━━━━━━━

⏳ 正在处理 {{payType}} 代付...
⏱️ 预计 2-10 分钟完成

💬 完成后会自动通知您
⚠️ 请勿关闭此页面
```

### 2. transfer_complete（代付完成通知）
**变量：**
- `{{orderId}}` - 订单号
- `{{amount}}` - 数量
- `{{payType}}` - 类型
- `{{address}}` - 收款地址（缩写）
- `{{txHash}}` - 交易哈希

**默认按钮：**
- 🔍 查看交易（链接到 TronScan）
- 📋 查看订单详情（回调）

**默认内容：**
```
✅ 代付完成！

━━━━━━━━━━━━━━━
订单号：{{orderId}}
数  量：{{amount}} {{payType}}
地  址：{{address}}
━━━━━━━━━━━━━━━

🔗 交易哈希
{{txHash}}

🔍 点击下方按钮查看交易详情
```

### 3. transfer_failed（代付失败通知）
**变量：**
- `{{orderId}}` - 订单号
- `{{amount}}` - 数量
- `{{payType}}` - 类型
- `{{reason}}` - 失败原因

**默认按钮：**
- 📋 查看订单（回调）

**默认内容：**
```
❌ 代付失败

━━━━━━━━━━━━━━━
订单号：{{orderId}}
数  量：{{amount}} {{payType}}
━━━━━━━━━━━━━━━

失败原因：
{{reason}}

💬 请联系客服处理
```

## 重启服务

如果修改后仍然看不到模板，请重启后端服务：

```bash
# 生产环境
pm2 restart easypay

# 或开发环境
npm run dev
```

## 验证模板是否生效

1. 创建一个测试订单
2. 完成支付流程
3. 观察 Telegram Bot 发送的通知
4. 如果创建了自定义模板，应该显示你的自定义内容
5. 如果没有创建，会显示代码中的默认内容

## 注意事项

⚠️ **重要**：
- 模板的 `key` 必须完全匹配（`payment_success`、`transfer_complete`、`transfer_failed`）
- 创建后确保"启用"开关是打开的
- 变量名必须使用 `{{变量名}}` 格式
- 按钮的 `callback_data` 中也可以使用变量（如 `order_detail_{{orderId}}`）

## 故障排查

如果还是看不到模板：

1. **清除浏览器缓存**：按 `Ctrl + Shift + Delete`，清除缓存后刷新
2. **检查前端文件**：确认 `dist/assets/index-*.js` 文件的修改时间是最新的
3. **检查控制台**：打开浏览器开发者工具（F12），查看是否有 JavaScript 错误
4. **重启服务**：`pm2 restart easypay`

## 下一步

创建模板后，你可以：
- 自定义消息文本和样式
- 添加或修改按钮
- 调整变量显示格式
- 上传自定义图片（将"内容类型"改为"图片"）
