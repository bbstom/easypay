# USDT 闪兑 TRX - 快速启动指南

## 🚀 快速开始

### 1. 启动服务

```bash
# 启动后端服务（监控服务会自动启动）
npm run server

# 启动前端服务
npm run dev
```

### 2. 管理员配置（首次使用）

#### 步骤1: 配置汇率
1. 登录管理后台
2. 进入 **系统设置 → 汇率设置**
3. 选择"实时汇率"模式
4. 点击"手动更新"获取最新汇率
5. 设置汇率加成（例如：0%）
6. 点击"保存设置"

#### 步骤2: 配置闪兑
1. 进入 **系统设置 → 闪兑设置**
2. 开启"启用闪兑功能"
3. 设置汇率加成：**2%**（推荐）
4. 设置最小金额：**10 USDT**
5. 设置最大金额：**10000 USDT**
6. 设置超时时间：**30 分钟**
7. 点击"保存设置"

#### 步骤3: 确保钱包配置
1. 进入 **钱包配置 → 钱包管理**
2. 确保至少有一个钱包状态为"活跃"
3. 检查钱包TRX余额是否充足

### 3. 用户使用流程

#### 访问闪兑页面
- 点击导航栏的 **"USDT闪兑TRX"**
- 或直接访问：`http://localhost:5173/swap`

#### 创建兑换订单
1. 查看当前汇率
2. 输入兑换金额（例如：100 USDT）
3. 输入接收地址（T开头的TRON地址）
4. 可选填写邮箱
5. 点击"创建兑换订单"

#### 完成转账
1. 复制系统提供的收款地址
2. 复制转账金额
3. 使用钱包向该地址转账USDT（TRC20）
4. 等待系统自动处理（1-5分钟）

## 📊 汇率计算说明

### 基础汇率
```
TRX/USDT 汇率 = TRX的CNY价格 / USDT的CNY价格
```

### 加成计算
```
最终汇率 = 基础汇率 × (1 - 加成% / 100)
```

### 示例
```
假设：
- USDT = 7.25 CNY
- TRX = 1.08 CNY
- 加成 = 2%

计算：
- 基础汇率 = 1.08 / 7.25 = 0.148966 TRX/USDT
- 最终汇率 = 0.148966 × (1 - 0.02) = 0.145987 TRX/USDT

用户兑换：
- 100 USDT → 14.5987 TRX
```

## 🔍 测试功能

### 测试汇率计算
```bash
node server/scripts/testSwap.js
```

输出示例：
```
📊 测试1: 获取闪兑汇率
==================================================
USDT汇率: 7.25 CNY
TRX汇率: 1.08 CNY
闪兑汇率: 0.145987 TRX/USDT
加成: 2 %

💰 测试2: 计算兑换金额
==================================================
10 USDT → 1.459870 TRX
50 USDT → 7.299350 TRX
100 USDT → 14.598700 TRX
500 USDT → 72.993500 TRX
1000 USDT → 145.987000 TRX
```

## ⚙️ 监控服务状态

### 查看服务日志
启动服务器后，会看到：
```
✅ MongoDB 连接成功
🔄 启动闪兑监控服务...
✅ 闪兑监控服务已启动
🚀 服务器运行在端口 5000
```

### 监控工作流程
- 每15秒检查一次待处理订单
- 自动检测USDT转账
- 自动发送TRX
- 自动处理超时订单

## 📧 邮件通知配置（可选）

如果需要邮件通知功能：

1. 进入 **系统设置 → 邮件配置**
2. 配置SMTP服务器信息
3. 保存设置

用户填写邮箱后，会收到：
- 订单完成通知
- 订单失败通知
- 订单超时通知

## 🛠️ 常见问题

### Q1: 订单一直显示"等待转账"？
**A:** 
- 确认已向正确地址转账
- 确认转账金额准确
- 确认选择了TRC20网络
- 等待区块确认（1-3分钟）

### Q2: 如何查看订单状态？
**A:**
- 订单页面会自动刷新状态（每5秒）
- 可以通过订单号查询
- 登录后可在个人中心查看历史订单

### Q3: 系统钱包余额不足怎么办？
**A:**
- 向系统钱包充值TRX
- 在钱包管理中查看余额
- 建议保持充足余额

### Q4: 如何修改汇率加成？
**A:**
- 进入系统设置 → 闪兑设置
- 修改"闪兑汇率加成"
- 保存后立即生效

### Q5: 订单失败如何处理？
**A:**
- 管理员可以在后台重试失败订单
- 查看错误信息定位问题
- 确保钱包余额和网络正常

## 📱 用户界面预览

### 闪兑页面
- 实时汇率显示
- 兑换金额计算器
- 地址输入框
- 创建订单按钮

### 订单页面
- 订单信息展示
- 转账指引
- 倒计时显示
- 状态实时更新

### 完成页面
- 成功/失败提示
- 交易哈希链接
- 再次兑换按钮

## 🎯 最佳实践

### 汇率设置
- 使用实时汇率模式
- 设置合理的加成（2-5%）
- 定期检查汇率准确性

### 金额限制
- 最小金额：10 USDT（避免小额交易）
- 最大金额：根据钱包余额设置
- 预留足够的TRX余额

### 监控管理
- 定期查看订单状态
- 及时处理失败订单
- 监控钱包余额

### 用户体验
- 提供清晰的操作指引
- 及时更新订单状态
- 配置邮件通知

## 🔐 安全建议

1. **钱包安全**
   - 定期备份私钥
   - 使用加密存储
   - 限制钱包权限

2. **金额控制**
   - 设置合理的单笔限额
   - 监控异常交易
   - 保持充足但不过多的余额

3. **系统监控**
   - 定期检查服务状态
   - 监控订单处理情况
   - 及时处理异常

## 📞 技术支持

如遇问题，请检查：
1. 服务器日志
2. 数据库连接
3. 钱包配置
4. 网络状态

## ✅ 启动检查清单

- [ ] 服务器已启动
- [ ] 数据库已连接
- [ ] 汇率已配置
- [ ] 闪兑功能已启用
- [ ] 钱包已配置且余额充足
- [ ] 监控服务已运行
- [ ] 前端页面可访问

全部完成后，系统即可正常使用！

## 🎉 开始使用

现在您可以：
1. 访问 `http://localhost:5173/swap`
2. 创建第一个闪兑订单
3. 体验自动化兑换流程

祝您使用愉快！
