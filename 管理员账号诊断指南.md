# ç®¡ç†å‘˜è´¦å·è¯Šæ–­æŒ‡å—

## âœ… ç¡®è®¤ï¼šåˆå§‹åŒ–è„šæœ¬æ˜¯æ­£ç¡®çš„

åˆå§‹åŒ–è„šæœ¬ `server/scripts/initDatabase.js` **ç¡®å®åˆ›å»ºäº†ç®¡ç†å‘˜è´¦å·**ã€‚

**ä»£ç è¯æ®ï¼ˆç¬¬ 67-71 è¡Œï¼‰ï¼š**
```javascript
const admin = await User.create({
  username,
  email,
  password: hashedPassword,
  role: 'admin'  // â† è¿™é‡Œæ˜ç¡®è®¾ç½®ä¸º admin
});
```

---

## ğŸ” å¯èƒ½çš„é—®é¢˜

### é—®é¢˜ 1ï¼šè„šæœ¬æ²¡æœ‰æˆåŠŸè¿è¡Œ

**ç—‡çŠ¶ï¼š**
- è¿è¡Œè„šæœ¬æ—¶å‡ºç°é”™è¯¯
- è„šæœ¬ä¸­é€”é€€å‡º
- æ²¡æœ‰çœ‹åˆ°"âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ"çš„æç¤º

**è§£å†³æ–¹æ³•ï¼š**
1. é‡æ–°è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š
   ```bash
   node server/scripts/initDatabase.js
   ```

2. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

3. ç¡®ä¿çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š
   ```
   âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ
      ç”¨æˆ·å: admin
      é‚®ç®±: admin@example.com
      å¯†ç : admin123
   ```

---

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥é”™è¯¯

**ç—‡çŠ¶ï¼š**
- æç¤º"æ•°æ®åº“è¿æ¥å¤±è´¥"
- MongoDB æ²¡æœ‰è¿è¡Œ

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ MongoDB æ˜¯å¦è¿è¡Œï¼š
   ```bash
   # å®å¡”é¢æ¿
   # è½¯ä»¶å•†åº— â†’ MongoDB â†’ æŸ¥çœ‹çŠ¶æ€
   
   # æˆ–å‘½ä»¤è¡Œ
   systemctl status mongod
   ```

2. æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ MONGODB_URIï¼š
   ```env
   MONGODB_URI=mongodb://localhost:27017/easypay
   ```

3. æµ‹è¯•è¿æ¥ï¼š
   ```bash
   mongosh mongodb://localhost:27017/easypay
   ```

---

### é—®é¢˜ 3ï¼šæŸ¥çœ‹æ•°æ®åº“æ—¶æ²¡æœ‰æ‰¾åˆ°ç®¡ç†å‘˜

**ç—‡çŠ¶ï¼š**
- è„šæœ¬è¿è¡ŒæˆåŠŸ
- ä½†åœ¨æ•°æ®åº“ä¸­æŸ¥ä¸åˆ°ç®¡ç†å‘˜

**å¯èƒ½åŸå› ï¼š**
- æŸ¥çœ‹äº†é”™è¯¯çš„æ•°æ®åº“
- æŸ¥çœ‹äº†é”™è¯¯çš„é›†åˆ
- æ²¡æœ‰åˆ·æ–°æ•°æ®åº“è§†å›¾

**è§£å†³æ–¹æ³•ï¼š**

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ£€æŸ¥è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
node server/scripts/checkAdmin.js
```

è¿™ä¸ªè„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- æ‰€æœ‰ç®¡ç†å‘˜è´¦å·
- æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯

#### æ–¹æ³•äºŒï¼šä½¿ç”¨ MongoDB å‘½ä»¤è¡Œ

```bash
# è¿æ¥æ•°æ®åº“
mongosh

# åˆ‡æ¢åˆ° easypay æ•°æ®åº“
use easypay

# æŸ¥çœ‹æ‰€æœ‰é›†åˆ
show collections

# æŸ¥æ‰¾ç®¡ç†å‘˜
db.users.find({ role: 'admin' })

# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
db.users.find()

# æ ¼å¼åŒ–è¾“å‡º
db.users.find({ role: 'admin' }).pretty()
```

#### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å®å¡” MongoDB ç®¡ç†å™¨

1. ç‚¹å‡»"è½¯ä»¶å•†åº—" â†’ "MongoDB" â†’ "è®¾ç½®"
2. ç‚¹å‡»"ç®¡ç†"
3. é€‰æ‹©æ•°æ®åº“ï¼š`easypay`
4. é€‰æ‹©é›†åˆï¼š`users`
5. æŸ¥çœ‹æ•°æ®

---

### é—®é¢˜ 4ï¼šç™»å½•æ—¶æç¤º"ç”¨æˆ·ä¸å­˜åœ¨"æˆ–"å¯†ç é”™è¯¯"

**ç—‡çŠ¶ï¼š**
- æ•°æ®åº“ä¸­æœ‰ç®¡ç†å‘˜è´¦å·
- ä½†æ— æ³•ç™»å½•

**å¯èƒ½åŸå› ï¼š**
- ç”¨æˆ·åæˆ–å¯†ç è¾“å…¥é”™è¯¯
- å¯†ç åŠ å¯†é—®é¢˜
- å‰åç«¯ä¸åŒ¹é…

**è§£å†³æ–¹æ³•ï¼š**

1. **ç¡®è®¤è´¦å·ä¿¡æ¯**
   
   è¿è¡Œæ£€æŸ¥è„šæœ¬æŸ¥çœ‹ç®¡ç†å‘˜ç”¨æˆ·åï¼š
   ```bash
   node server/scripts/checkAdmin.js
   ```

2. **ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•**
   
   å¦‚æœä½¿ç”¨é»˜è®¤é…ç½®ï¼š
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`

3. **é‡ç½®ç®¡ç†å‘˜å¯†ç **
   
   åˆ›å»ºé‡ç½®è„šæœ¬ `server/scripts/resetAdminPassword.js`ï¼š
   ```javascript
   require('dotenv').config();
   const mongoose = require('mongoose');
   const bcrypt = require('bcryptjs');
   const User = require('../models/User');

   async function resetPassword() {
     try {
       await mongoose.connect(process.env.MONGODB_URI);
       
       const admin = await User.findOne({ role: 'admin' });
       if (!admin) {
         console.log('âŒ æœªæ‰¾åˆ°ç®¡ç†å‘˜è´¦å·');
         process.exit(1);
       }
       
       const newPassword = 'admin123';
       admin.password = await bcrypt.hash(newPassword, 10);
       await admin.save();
       
       console.log('âœ… å¯†ç é‡ç½®æˆåŠŸ');
       console.log('ç”¨æˆ·å:', admin.username);
       console.log('æ–°å¯†ç :', newPassword);
       
       await mongoose.disconnect();
       process.exit(0);
     } catch (error) {
       console.error('âŒ é‡ç½®å¤±è´¥:', error);
       process.exit(1);
     }
   }

   resetPassword();
   ```
   
   è¿è¡Œï¼š
   ```bash
   node server/scripts/resetAdminPassword.js
   ```

---

### é—®é¢˜ 5ï¼šåˆ›å»ºçš„æ˜¯æ™®é€šç”¨æˆ·è€Œä¸æ˜¯ç®¡ç†å‘˜

**ç—‡çŠ¶ï¼š**
- å¯ä»¥ç™»å½•
- ä½†æ— æ³•è®¿é—®ç®¡ç†åå°
- æç¤º"æƒé™ä¸è¶³"

**è¯Šæ–­æ–¹æ³•ï¼š**

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š
```bash
node server/scripts/checkAdmin.js
```

æŸ¥çœ‹è¾“å‡ºä¸­çš„"è§’è‰²"å­—æ®µï¼š
- âœ… æ­£ç¡®ï¼š`è§’è‰²: admin`
- âŒ é”™è¯¯ï¼š`è§’è‰²: user`

**è§£å†³æ–¹æ³•ï¼š**

å¦‚æœè§’è‰²æ˜¯ `user`ï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸º `admin`ï¼š

```bash
# è¿æ¥æ•°æ®åº“
mongosh

# åˆ‡æ¢æ•°æ®åº“
use easypay

# æ›´æ–°ç”¨æˆ·è§’è‰²
db.users.updateOne(
  { username: 'admin' },
  { $set: { role: 'admin' } }
)

# éªŒè¯
db.users.findOne({ username: 'admin' })
```

---

## ğŸ¯ å¿«é€Ÿè¯Šæ–­æµç¨‹

### æ­¥éª¤ 1ï¼šè¿è¡Œæ£€æŸ¥è„šæœ¬

```bash
cd /www/wwwroot/your-domain
node server/scripts/checkAdmin.js
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ… æ‰¾åˆ° 1 ä¸ªç®¡ç†å‘˜è´¦å·ï¼š

ç®¡ç†å‘˜ 1:
  ID: 507f1f77bcf86cd799439011
  ç”¨æˆ·å: admin
  é‚®ç®±: admin@example.com
  è§’è‰²: admin
  åˆ›å»ºæ—¶é—´: 2026-02-03T10:00:00.000Z
```

### æ­¥éª¤ 2ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç®¡ç†å‘˜

é‡æ–°è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š
```bash
node server/scripts/initDatabase.js
```

### æ­¥éª¤ 3ï¼šæµ‹è¯•ç™»å½•

è®¿é—®ï¼š`https://your-domain.com/login`

ä½¿ç”¨è´¦å·ï¼š
- ç”¨æˆ·åï¼š`admin`ï¼ˆæˆ–ä½ è®¾ç½®çš„ç”¨æˆ·åï¼‰
- å¯†ç ï¼š`admin123`ï¼ˆæˆ–ä½ è®¾ç½®çš„å¯†ç ï¼‰

### æ­¥éª¤ 4ï¼šå¦‚æœä»ç„¶æ— æ³•ç™»å½•

1. æ£€æŸ¥åç«¯æ—¥å¿—ï¼š
   ```bash
   pm2 logs easypay-backend
   ```

2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æ˜¯å¦æœ‰é”™è¯¯

3. ç¡®è®¤ API æ˜¯å¦æ­£å¸¸ï¼š
   ```bash
   curl https://your-domain.com/api/settings/public
   ```

---

## ğŸ“Š éªŒè¯æ¸…å•

- [ ] MongoDB æ­£åœ¨è¿è¡Œ
- [ ] .env æ–‡ä»¶é…ç½®æ­£ç¡®
- [ ] åˆå§‹åŒ–è„šæœ¬è¿è¡ŒæˆåŠŸ
- [ ] çœ‹åˆ°"âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ"æç¤º
- [ ] æ£€æŸ¥è„šæœ¬æ˜¾ç¤ºæœ‰ç®¡ç†å‘˜è´¦å·
- [ ] ç®¡ç†å‘˜è§’è‰²æ˜¯ `admin`
- [ ] å¯ä»¥ä½¿ç”¨è´¦å·å¯†ç ç™»å½•
- [ ] ç™»å½•åå¯ä»¥è®¿é—®ç®¡ç†åå°

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æ£€æŸ¥ç®¡ç†å‘˜
```bash
node server/scripts/checkAdmin.js
```

### é‡æ–°åˆå§‹åŒ–
```bash
node server/scripts/initDatabase.js
```

### æŸ¥çœ‹æ•°æ®åº“
```bash
mongosh
use easypay
db.users.find({ role: 'admin' }).pretty()
```

### æŸ¥çœ‹åç«¯æ—¥å¿—
```bash
pm2 logs easypay-backend
```

---

## ğŸ’¡ é‡è¦æç¤º

1. **åˆå§‹åŒ–è„šæœ¬ç¡®å®åˆ›å»ºç®¡ç†å‘˜è´¦å·**
   - ä»£ç ä¸­æ˜ç¡®è®¾ç½® `role: 'admin'`
   - è¿™ä¸æ˜¯ bugï¼Œæ˜¯æ­£ç¡®çš„å®ç°

2. **é»˜è®¤è´¦å·ä¿¡æ¯**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`
   - è§’è‰²ï¼š`admin`

3. **ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç **
   - è¿›å…¥"ç”¨æˆ·ä¸­å¿ƒ"
   - ä¿®æ”¹ä¸ºå¼ºå¯†ç 

4. **å¦‚æœå¿˜è®°å¯†ç **
   - ä½¿ç”¨é‡ç½®å¯†ç è„šæœ¬
   - æˆ–é‡æ–°è¿è¡Œåˆå§‹åŒ–è„šæœ¬

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. åˆå§‹åŒ–è„šæœ¬çš„å®Œæ•´è¾“å‡º
2. æ£€æŸ¥è„šæœ¬çš„è¾“å‡ºç»“æœ
3. åç«¯æ—¥å¿—ï¼ˆ`pm2 logs easypay-backend`ï¼‰
4. ç™»å½•æ—¶çš„é”™è¯¯ä¿¡æ¯

---

**è¯Šæ–­æŒ‡å—ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-03
