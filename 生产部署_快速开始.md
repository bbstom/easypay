# ç”Ÿäº§éƒ¨ç½² - å¿«é€Ÿå¼€å§‹

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

### å‰ææ¡ä»¶

- âœ… Ubuntu 20.04+ æˆ– CentOS 7+ æœåŠ¡å™¨
- âœ… å·²å®‰è£… Node.js 18+
- âœ… å·²å®‰è£… MongoDB
- âœ… å·²å®‰è£… Nginx
- âœ… æœ‰åŸŸåå’Œ SSL è¯ä¹¦

---

## ğŸ“ éƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ ä»£ç 

```bash
# ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
cd /var/www
sudo git clone <your-repo> easypay
cd easypay
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

**å¿…é¡»ä¿®æ”¹çš„é…ç½®ï¼š**
```env
NODE_ENV=production
MONGODB_URI=mongodb://localhost:27017/easypay
JWT_SECRET=<ç”Ÿæˆéšæœºå­—ç¬¦ä¸²>
MASTER_KEY=<ç”Ÿæˆéšæœºå­—ç¬¦ä¸²>
FRONTEND_URL=https://your-domain.com
```

**ç”Ÿæˆå¯†é’¥ï¼š**
```bash
# JWT_SECRET
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# MASTER_KEY
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### 3. è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# è¿è¡Œéƒ¨ç½²
bash deploy.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨ï¼š**
- âœ… å®‰è£…ä¾èµ–
- âœ… æ„å»ºå‰ç«¯
- âœ… æ£€æŸ¥æ•°æ®åº“è¿æ¥
- âœ… åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
- âœ… å¯åŠ¨åç«¯æœåŠ¡

### 4. é…ç½® Nginx

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
sudo cp nginxé…ç½®ç¤ºä¾‹.conf /etc/nginx/sites-available/easypay

# ç¼–è¾‘é…ç½®ï¼ˆä¿®æ”¹åŸŸåï¼‰
sudo nano /etc/nginx/sites-available/easypay

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/easypay /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### 5. é…ç½® SSL

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com
```

### 6. è®¿é—®ç½‘ç«™

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`https://your-domain.com`

---

## ğŸ”§ æ•°æ®åº“åˆå§‹åŒ–

### è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

éƒ¨ç½²è„šæœ¬ä¼šè¯¢é—®æ˜¯å¦åˆå§‹åŒ–æ•°æ®åº“ï¼Œé€‰æ‹© `y` å³å¯ã€‚

### æ‰‹åŠ¨åˆå§‹åŒ–

```bash
npm run init-db
```

**æŒ‰æç¤ºè¾“å…¥ï¼š**
- ç®¡ç†å‘˜ç”¨æˆ·åï¼ˆé»˜è®¤ï¼šadminï¼‰
- ç®¡ç†å‘˜é‚®ç®±
- ç®¡ç†å‘˜å¯†ç 
- ç½‘ç«™åç§°

---

## ğŸ“Š éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹åç«¯æœåŠ¡
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs easypay-backend

# æŸ¥çœ‹ Nginx
sudo systemctl status nginx
```

### 2. æµ‹è¯•è®¿é—®

```bash
# æµ‹è¯•å‰ç«¯
curl -I https://your-domain.com

# æµ‹è¯• API
curl https://your-domain.com/api/settings/public
```

### 3. ç™»å½•ç®¡ç†åå°

è®¿é—®ï¼š`https://your-domain.com/login`

ä½¿ç”¨åˆå§‹åŒ–æ—¶åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•ã€‚

---

## âš™ï¸ åç»­é…ç½®

ç™»å½•ç®¡ç†åå°åï¼Œå®Œæˆä»¥ä¸‹é…ç½®ï¼š

### 1. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç  âš ï¸

è¿›å…¥"ç”¨æˆ·ä¸­å¿ƒ" â†’ ä¿®æ”¹å¯†ç 

### 2. é…ç½®æ”¯ä»˜å¹³å° âš ï¸

è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "æ”¯ä»˜é…ç½®"
- å•†æˆ·ID
- APIå¯†é’¥
- å›è°ƒåœ°å€ï¼š`https://your-domain.com/api/payments/notify`

### 3. æ·»åŠ ä»£ä»˜é’±åŒ… âš ï¸

è¿›å…¥"ä»£ä»˜ç³»ç»Ÿ" â†’ "é’±åŒ…é…ç½®"
- æ·»åŠ é’±åŒ…
- å¡«å†™åœ°å€å’Œç§é’¥

### 4. é…ç½®èƒ½é‡ç§Ÿèµï¼ˆæ¨èï¼‰

è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "èƒ½é‡ç§Ÿèµ"
- å¯ç”¨èƒ½é‡ç§Ÿèµ
- é€‰æ‹© CatFee API æ¨¡å¼
- å¡«å†™ API Key

### 5. é…ç½®é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "é‚®ä»¶é…ç½®"
- SMTP æœåŠ¡å™¨
- é‚®ç®±è´¦å·å¯†ç 

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

```bash
cd /var/www/easypay

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°éƒ¨ç½²
bash deploy.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ MongoDB çŠ¶æ€
sudo systemctl status mongod

# å¯åŠ¨ MongoDB
sudo systemctl start mongod

# æ£€æŸ¥ .env ä¸­çš„ MONGODB_URI
```

### é—®é¢˜ 2ï¼šæ— æ³•è®¿é—®ç½‘ç«™

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### é—®é¢˜ 3ï¼šAPI è¯·æ±‚å¤±è´¥

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
pm2 status
pm2 logs easypay-backend

# é‡å¯æœåŠ¡
pm2 restart easypay-backend
```

---

## ğŸ“‹ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### PM2 å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs easypay-backend

# é‡å¯æœåŠ¡
pm2 restart easypay-backend

# åœæ­¢æœåŠ¡
pm2 stop easypay-backend

# ç›‘æ§
pm2 monit
```

### Nginx å‘½ä»¤

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯
sudo systemctl restart nginx

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### MongoDB å‘½ä»¤

```bash
# è¿æ¥æ•°æ®åº“
mongosh

# æŸ¥çœ‹æ•°æ®åº“
show dbs

# åˆ‡æ¢æ•°æ®åº“
use easypay

# æŸ¥çœ‹é›†åˆ
show collections

# æŸ¥çœ‹ç®¡ç†å‘˜
db.users.find({ role: 'admin' })
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

è¯¦ç»†æ–‡æ¡£ï¼š`ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—.md`

---

**å¿«é€Ÿå¼€å§‹ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-02
