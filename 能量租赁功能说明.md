# 能量租赁功能说明

## 功能概述

能量租赁功能采用**按需租赁**策略：只在实际需要转账且能量不足时才租赁能量，无需提前储备，节省成本。

## 工作流程（按需租赁）

```
用户发起代付
   ↓
用户完成支付
   ↓
系统检查钱包能量
   ↓
能量是否足够？
   ├─ 是 → 直接执行 USDT 转账 ✅
   └─ 否 → 触发能量租赁
          ↓
       向租赁地址发送 TRX
          ↓
       等待能量到账（30秒）
          ↓
       执行 USDT 转账 ✅
```

## 按需租赁的优势

### 1. 成本优化
- ❌ **不推荐**：提前储备大量能量（会过期浪费）
- ✅ **推荐**：按需租赁，用多少租多少

### 2. 灵活性
- 转账量少时：不租赁或少租赁
- 转账量多时：自动增加租赁
- 完全自动化，无需人工干预

### 3. 资金利用率
- 不需要质押大量 TRX
- TRX 可以灵活使用
- 只在需要时支付少量租赁费用

## 配置参数

### 1. 启用能量租赁
- **默认值**：关闭
- **说明**：开启后，系统会在能量不足时自动租赁

### 2. 租赁服务商地址
- **格式**：TRON 地址（T 开头）
- **说明**：能量租赁服务商的收款地址
- **示例**：`TXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### 3. 首次转账租赁金额
- **默认值**：5 TRX
- **范围**：1-100 TRX
- **说明**：目标地址无 USDT 时的租赁金额（激活账户需要约 31,895 能量）
- **建议**：5 TRX（约 50,000 能量，足够首次转账）

### 4. 正常转账租赁金额
- **默认值**：10 TRX
- **范围**：1-100 TRX
- **说明**：目标地址有 USDT 时的租赁金额（需要约 65,000 能量）
- **建议**：
  - 小规模：10 TRX（约 100,000 能量，支持 1-2 笔）
  - 中等规模：20 TRX（约 200,000 能量，支持 3-4 笔）
  - 大规模：50 TRX（约 500,000 能量，支持 7-8 笔）

### 5. 等待时间
- **默认值**：30 秒
- **范围**：10-120 秒
- **说明**：等待能量到账的时间
- **建议**：30 秒（大多数服务商在 10-30 秒内到账）

### 6. 触发租赁的能量阈值
- **默认值**：65,000
- **范围**：10,000-100,000
- **说明**：当能量低于此值时触发租赁
- **建议**：65,000（系统会自动判断目标地址是否首次接收 USDT）
- **重要**：这是触发租赁的条件，不是提前储备的目标

## 智能判断机制

系统会自动检测目标地址是否首次接收 USDT，并使用不同的租赁金额：

### 首次转账（激活账户）
```
目标地址无 USDT → 需要约 31,895 能量
系统使用：首次转账租赁金额（默认 5 TRX）
```

### 正常转账
```
目标地址有 USDT → 需要约 65,000 能量
系统使用：正常转账租赁金额（默认 10 TRX）
```

这样可以节省成本，避免首次转账时租赁过多能量。

## 按需租赁 vs 提前储备

### ❌ 提前储备（不推荐）
```
问题：
- 能量会过期（1-24小时）
- 浪费资金
- 需要预测转账量
- 储备过多或过少都不好
```

### ✅ 按需租赁（推荐）
```
优势：
- 只在需要时租赁
- 不会浪费
- 自动化管理
- 成本可控
```

## 实际运行示例

### 场景 1：能量充足
```
用户支付 → 检查能量（50,000）→ 足够 → 直接转账 ✅
成本：0 TRX（使用现有能量）
```

### 场景 2：能量不足
```
用户支付 → 检查能量（5,000）→ 不足 → 租赁能量（10 TRX）
→ 等待 30 秒 → 获得 100,000 能量 → 转账 ✅
成本：10 TRX
```

### 场景 3：连续转账
```
第1笔：能量 5,000 → 租赁 → 获得 100,000 → 转账（剩余 86,500）
第2笔：能量 86,500 → 足够 → 直接转账（剩余 73,000）
第3笔：能量 73,000 → 足够 → 直接转账（剩余 59,500）
第4笔：能量 59,500 → 足够 → 直接转账（剩余 46,000）
第5笔：能量 46,000 → 足够 → 直接转账（剩余 32,500）
第6笔：能量 32,500 → 足够 → 直接转账（剩余 19,000）
第7笔：能量 19,000 → 不足 → 租赁 → 转账

一次租赁支持约 6-7 笔转账
```

## 成本对比

### 不使用能量租赁
```
每笔 USDT 转账消耗：13-15 TRX
10 笔/天 = 135 TRX/天
月成本 = 4,050 TRX
```

### 使用能量租赁
```
每次租赁：10 TRX
获得能量：约 100,000
可转账：约 7 笔
平均成本：1.4 TRX/笔

10 笔/天 = 14 TRX/天
月成本 = 420 TRX
```

**节省成本：约 90%**

## 租赁服务商选择

### 推荐平台

1. **JustLend Energy Rental**
   - 地址：需要在平台获取
   - 费用：约 10 TRX = 100,000 能量
   - 到账时间：10-30 秒

2. **TronEnergy.market**
   - 地址：需要在平台获取
   - 费用：约 15 TRX = 150,000 能量
   - 到账时间：即时

3. **EnergyRental.io**
   - 地址：需要在平台获取
   - 费用：约 12 TRX = 120,000 能量
   - 到账时间：15-45 秒

### 如何获取租赁地址

1. 访问租赁平台网站
2. 注册/登录账户
3. 找到"能量租赁"或"Energy Rental"功能
4. 获取专属租赁地址
5. 复制地址到系统配置中

## 配置步骤

### 1. 进入钱包配置
```
管理后台 → 钱包配置 → 基础配置
```

### 2. 找到能量租赁配置
向下滚动到"能量租赁配置"部分

### 3. 启用功能
打开"启用能量租赁"开关

### 4. 填写配置
```yaml
租赁服务商地址: TXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
首次转账租赁金额: 5 TRX
正常转账租赁金额: 10 TRX
等待时间: 30 秒
触发阈值: 65000
```

### 5. 保存配置
点击"保存配置"按钮

### 6. 测试
可以在状态监控页面查看能量变化

## 监控和日志

### 状态监控
在"钱包配置 → 状态监控"页面可以看到：
- 当前能量余额
- 能量使用情况
- 租赁记录

### 日志输出
系统会在控制台输出详细日志：
```
⚠️  能量不足 32000，开始租赁能量...
💰 向 TXxx...xx 发送 10 TRX 租赁能量...
✅ 租赁支付成功，交易哈希: xxx
⏳ 等待 30 秒，等待能量到账...
📊 租赁前能量: 5000
📊 租赁后能量: 105000
✨ 获得能量: 100000
✅ 能量租赁成功
```

## 故障排查

### Q1: 能量没有到账怎么办？
**A**: 
1. 检查租赁地址是否正确
2. 增加等待时间（改为 60 秒）
3. 联系租赁服务商客服
4. 检查 TRX 是否成功发送

### Q2: 租赁失败会影响转账吗？
**A**: 不会。如果租赁失败，系统会自动使用 TRX 支付手续费完成转账。

### Q3: 可以同时使用质押和租赁吗？
**A**: 可以。建议配置：
- 质押 10,000 TRX（基础能量）
- 启用租赁（高峰期补充）

### Q4: 租赁的能量会过期吗？
**A**: 会。租赁的能量通常在 1-24 小时后过期，具体取决于服务商。

### Q5: 如何选择租赁金额？
**A**: 系统会自动判断：
- 首次转账（激活账户）：使用首次转账租赁金额（默认 5 TRX）
- 正常转账：使用正常转账租赁金额（默认 10 TRX）

根据日均转账量调整正常转账金额：
- 1-5 笔/天：10 TRX
- 5-10 笔/天：20 TRX
- 10-20 笔/天：30 TRX
- 20+ 笔/天：50 TRX

## 最佳实践

### 推荐配置
```yaml
能量租赁配置:
  启用: 是
  租赁地址: [从服务商获取]
  首次转账租赁金额: 5 TRX
  正常转账租赁金额: 10 TRX
  等待时间: 30 秒
  触发阈值: 65000

转账配置:
  自动转账: 是
  最大重试: 3 次
```

### 成本优化
1. **低频场景**（< 5 笔/天）
   - 使用能量租赁
   - 不需要质押

2. **中频场景**（5-20 笔/天）
   - 质押 10,000 TRX
   - 启用租赁作为补充

3. **高频场景**（> 20 笔/天）
   - 质押 50,000+ TRX
   - 启用租赁应对高峰

## 安全提示

1. ⚠️ 只向可信的租赁服务商发送 TRX
2. ⚠️ 定期检查租赁服务商的信誉
3. ⚠️ 不要设置过高的租赁金额
4. ⚠️ 监控 TRX 余额，确保有足够余额支付租赁费用
5. ⚠️ 保存好租赁服务商的联系方式

## 总结

能量租赁是一种灵活、经济的能量获取方式，特别适合：
- 不想质押大量 TRX 的用户
- 转账量不稳定的场景
- 需要快速获取能量的情况

通过合理配置，可以大幅降低 USDT 转账成本，提高系统运营效率。

---

*更新时间: 2026-01-29*
