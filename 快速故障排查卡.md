# ğŸ”§ å¿«é€Ÿæ•…éšœæ’æŸ¥å¡

## å¸¸è§é”™è¯¯é€ŸæŸ¥

### âŒ Error: "there is no text in the message to edit"

**åŸå› **ï¼šå°è¯•ç¼–è¾‘å›¾ç‰‡æ¶ˆæ¯æˆ–ä¸å­˜åœ¨çš„æ¶ˆæ¯

**å·²ä¿®å¤**ï¼šâœ… æ‰€æœ‰ handler éƒ½å·²æ·»åŠ  try-catch é™çº§

**éªŒè¯**ï¼š
```bash
node test-editMessageText-fix.js
```

**å¦‚æœä»å‡ºç°**ï¼š
1. é‡å¯æœåŠ¡å™¨ï¼š`pm2 restart easypay`
2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿å­˜
3. æŸ¥çœ‹å…·ä½“é”™è¯¯ä½ç½®

---

### âŒ Error: "answerCbQuery isn't available for message"

**åŸå› **ï¼šåœ¨ message ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ answerCbQuery

**å·²ä¿®å¤**ï¼šâœ… æ‰€æœ‰ handler éƒ½å·²æ·»åŠ æ¡ä»¶æ£€æŸ¥

**ä¿®å¤ä»£ç **ï¼š
```javascript
if (ctx.callbackQuery && ctx.update?.callback_query) {
  await ctx.answerCbQuery();
}
```

---

### âŒ Error: "function is not a function"

**åŸå› **ï¼šå‡½æ•°åä¸åŒ¹é…

**å·²ä¿®å¤**ï¼šâœ… commandHandler.js ä¸­æ‰€æœ‰å‡½æ•°è°ƒç”¨å·²ä¿®æ­£

**éªŒè¯**ï¼š
- `/swap` â†’ è°ƒç”¨ `swapHandler.start()`
- `/energy` â†’ è°ƒç”¨ `energyHandler.start()`

---

### âš ï¸ å‘½ä»¤èœå•ä¸æ›´æ–°

**åŸå› **ï¼šTelegram å®¢æˆ·ç«¯ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç”¨æˆ·åœ¨ Telegram ä¸­åœæ­¢ Bot
2. é‡æ–°å‘é€ `/start`
3. æˆ–ç­‰å¾… 5-15 åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°

**ä¸éœ€è¦**ï¼šé‡å¯æœåŠ¡å™¨ï¼ˆå‘½ä»¤å·²æ³¨å†Œï¼‰

---

## å¿«é€Ÿæµ‹è¯•æµç¨‹

### 1ï¸âƒ£ åŸºç¡€æµ‹è¯•ï¼ˆ2åˆ†é’Ÿï¼‰
```
âœ“ /start - æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
âœ“ /menu - æ˜¾ç¤ºä¸»èœå•
âœ“ /pay - æ˜¾ç¤ºä»£ä»˜é€‰é¡¹
âœ“ /help - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### 2ï¸âƒ£ åŠŸèƒ½æµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰
```
âœ“ ä»£ä»˜æœåŠ¡ â†’ USDT â†’ è¾“å…¥æ•°é‡
âœ“ èƒ½é‡ç§Ÿèµ â†’ æ˜¾ç¤ºäºŒç»´ç 
âœ“ é—ªå…‘æœåŠ¡ â†’ æ˜¾ç¤ºäºŒç»´ç 
âœ“ æˆ‘çš„è®¢å• â†’ æ˜¾ç¤ºè®¢å•åˆ—è¡¨
```

### 3ï¸âƒ£ è¾¹ç•Œæµ‹è¯•ï¼ˆ3åˆ†é’Ÿï¼‰
```
âœ“ èƒ½é‡ç§Ÿèµ â†’ è¿”å›ä¸»èœå• â†’ ä»£ä»˜æœåŠ¡
âœ“ é—ªå…‘æœåŠ¡ â†’ è¿”å›ä¸»èœå• â†’ ä»£ä»˜æœåŠ¡
âœ“ å¿«æ·å‘½ä»¤ /pay â†’ é€‰æ‹© USDT
```

---

## é‡å¯æœåŠ¡å™¨

### PM2
```bash
pm2 restart easypay
pm2 logs easypay --lines 50
```

### NPM
```bash
# Ctrl+C åœæ­¢
npm run dev
```

### Node
```bash
# Ctrl+C åœæ­¢
node server/index.js
```

---

## æ—¥å¿—æ£€æŸ¥

### æ­£å¸¸æ—¥å¿— âœ…
```
âœ… å·²è®¾ç½® Bot å¿«æ·æŒ‡ä»¤: 9 ä¸ª
ğŸ“ å¤„ç†å‘½ä»¤: pay
ğŸ’° USDT ä»£ä»˜
ğŸ“± TG: message - 520ms
```

### é”™è¯¯æ—¥å¿— âŒ
```
âŒ TelegramError: Bad Request: there is no text in the message to edit
âŒ TypeError: answerCbQuery isn't available for "message"
âŒ TypeError: swapHandler.handleSwap is not a function
```

å¦‚æœçœ‹åˆ°é”™è¯¯æ—¥å¿—ï¼š
1. ç¡®è®¤æœåŠ¡å™¨å·²é‡å¯
2. ç¡®è®¤æ–‡ä»¶å·²ä¿å­˜
3. è¿è¡ŒéªŒè¯è„šæœ¬

---

## æ–‡ä»¶æ£€æŸ¥æ¸…å•

### å¿…é¡»ä¿®å¤çš„æ–‡ä»¶ âœ…
- [x] `server/bot/handlers/payment.js`
- [x] `server/bot/handlers/orders.js`
- [x] `server/bot/handlers/tickets.js`
- [x] `server/bot/handlers/start.js`
- [x] `server/bot/handlers/swap.js`
- [x] `server/bot/handlers/energy.js`
- [x] `server/bot/commandHandler.js`

### éªŒè¯æ–¹æ³•
```bash
node test-editMessageText-fix.js
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
âœ… æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰æ­£ç¡®çš„é”™è¯¯å¤„ç†ï¼
```

---

## ç´§æ€¥ä¿®å¤æ­¥éª¤

å¦‚æœæµ‹è¯•å¤±è´¥ï¼š

### Step 1: ç¡®è®¤ä¿®æ”¹å·²ä¿å­˜
```bash
# æ£€æŸ¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´
ls -la server/bot/handlers/payment.js
```

### Step 2: å¼ºåˆ¶é‡å¯
```bash
pm2 delete easypay
pm2 start ecosystem.config.js
```

### Step 3: æ¸…é™¤ç¼“å­˜
```bash
# åˆ é™¤ node_modules/.cache (å¦‚æœå­˜åœ¨)
rm -rf node_modules/.cache
```

### Step 4: æŸ¥çœ‹å®Œæ•´æ—¥å¿—
```bash
pm2 logs easypay --lines 100
```

---

## è”ç³»ä¿¡æ¯

### ç›¸å…³æ–‡æ¡£
- ğŸ“„ `ä¿®å¤å®Œæˆ_ä¸‹ä¸€æ­¥æ“ä½œ.md` - å®Œæ•´æ“ä½œæŒ‡å—
- ğŸ“„ `Telegram_Bot_editMessageTextå®Œæ•´ä¿®å¤è¯´æ˜.md` - æŠ€æœ¯ç»†èŠ‚
- ğŸ“„ `HOTFIX_å‘½ä»¤è°ƒç”¨editMessageTexté”™è¯¯ä¿®å¤.md` - ä¿®å¤è®°å½•

### æµ‹è¯•è„šæœ¬
```bash
node test-editMessageText-fix.js
node test-bot-commands.js
```

---

## ä¸€é”®æ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥ä¿®å¤çŠ¶æ€
node test-editMessageText-fix.js

# é‡å¯æœåŠ¡
pm2 restart easypay

# æŸ¥çœ‹æ—¥å¿—
pm2 logs easypay --lines 20

# æµ‹è¯•å‘½ä»¤
# åœ¨ Telegram ä¸­å‘é€: /start, /pay, /swap, /energy
```

---

## æˆåŠŸæ ‡å¿— âœ…

å½“çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

1. âœ… æ‰€æœ‰å‘½ä»¤éƒ½èƒ½æ­£å¸¸å·¥ä½œ
2. âœ… æŒ‰é’®ç‚¹å‡»ä¸æŠ¥é”™
3. âœ… æ—¥å¿—ä¸­æ²¡æœ‰ editMessageText é”™è¯¯
4. âœ… æ—¥å¿—ä¸­æ²¡æœ‰ answerCbQuery é”™è¯¯
5. âœ… ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½

---

**æœ€åæ›´æ–°**: 2024
**çŠ¶æ€**: âœ… æ‰€æœ‰ä¿®å¤å·²å®Œæˆ
