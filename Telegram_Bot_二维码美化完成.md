# Telegram Bot äºŒç»´ç ç¾åŒ–å®Œæˆ

## å®Œæˆæ—¶é—´
2026-02-05

## åŠŸèƒ½è¯´æ˜

ä¸º Telegram Bot çš„æ‰€æœ‰äºŒç»´ç æ·»åŠ äº†ç¾åŒ–æ•ˆæœï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ¸å˜èƒŒæ™¯
- âœ… å½©è‰²åœ†è§’è¾¹æ¡†
- âœ… åº•éƒ¨æ ‡è¯†æ–‡å­—
- âœ… ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒé…è‰²

## ç¾åŒ–æ•ˆæœ

### 1. èƒ½é‡ç§ŸèµäºŒç»´ç  âš¡
- **è¾¹æ¡†é¢œè‰²**: ç»¿è‰² (#10B981)
- **èƒŒæ™¯æ¸å˜**: æµ…ç»¿åˆ°ç™½è‰² (#D1FAE5 â†’ #FFFFFF)
- **åº•éƒ¨æ–‡å­—**: "âš¡ èƒ½é‡ç§Ÿèµ"
- **å°ºå¯¸**: 200x200px + 20px å†…è¾¹è·

### 2. é—ªå…‘æœåŠ¡äºŒç»´ç  ğŸ”„
- **è¾¹æ¡†é¢œè‰²**: è“è‰² (#3B82F6)
- **èƒŒæ™¯æ¸å˜**: æµ…è“åˆ°ç™½è‰² (#DBEAFE â†’ #FFFFFF)
- **åº•éƒ¨æ–‡å­—**: "ğŸ”„ USDT é—ªå…‘"
- **å°ºå¯¸**: 200x200px + 20px å†…è¾¹è·

### 3. æ”¯ä»˜äºŒç»´ç  ğŸ’³
- **è¾¹æ¡†é¢œè‰²**: æ©™è‰² (#F59E0B)
- **èƒŒæ™¯æ¸å˜**: æµ…æ©™åˆ°ç™½è‰² (#FEF3C7 â†’ #FFFFFF)
- **åº•éƒ¨æ–‡å­—**: "ğŸ’³  æ‰«ç æ”¯ä»˜"
- **å°ºå¯¸**: 200x200px + 20px å†…è¾¹è·

## æŠ€æœ¯å®ç°

### æ–°å¢æ–‡ä»¶
- `server/bot/utils/qrCodeGenerator.js` - äºŒç»´ç ç¾åŒ–å·¥å…·

### ä¾èµ–åº“
```bash
npm install canvas
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. é€šç”¨äºŒç»´ç ç”Ÿæˆå™¨
```javascript
generateStyledQRCode(data, options)
```

**å‚æ•°è¯´æ˜**:
- `data`: äºŒç»´ç æ•°æ®ï¼ˆåœ°å€æˆ–URLï¼‰
- `options`: é…ç½®é€‰é¡¹
  - `size`: äºŒç»´ç å°ºå¯¸ï¼ˆé»˜è®¤ 200ï¼‰
  - `padding`: å†…è¾¹è·ï¼ˆé»˜è®¤ 20ï¼‰
  - `borderRadius`: åœ†è§’åŠå¾„ï¼ˆé»˜è®¤ 16ï¼‰
  - `borderWidth`: è¾¹æ¡†å®½åº¦ï¼ˆé»˜è®¤ 3ï¼‰
  - `borderColor`: è¾¹æ¡†é¢œè‰²
  - `gradientStart`: æ¸å˜èµ·å§‹è‰²
  - `gradientEnd`: æ¸å˜ç»“æŸè‰²
  - `qrColor`: äºŒç»´ç é¢œè‰²ï¼ˆé»˜è®¤é»‘è‰²ï¼‰
  - `logoText`: åº•éƒ¨æ–‡å­—ï¼ˆå¯é€‰ï¼‰
  - `logoTextColor`: æ–‡å­—é¢œè‰²

#### 2. ä¸“ç”¨ç”Ÿæˆå™¨
- `generateEnergyQRCode(address)` - èƒ½é‡ç§Ÿèµ
- `generateSwapQRCode(address)` - é—ªå…‘æœåŠ¡
- `generatePaymentQRCode(paymentUrl)` - æ”¯ä»˜

### ç»˜åˆ¶æµç¨‹

1. **ç”ŸæˆåŸå§‹äºŒç»´ç ** - ä½¿ç”¨ qrcode åº“ç”Ÿæˆé€æ˜èƒŒæ™¯çš„äºŒç»´ç 
2. **åˆ›å»ºç”»å¸ƒ** - ä½¿ç”¨ canvas åˆ›å»ºæŒ‡å®šå°ºå¯¸çš„ç”»å¸ƒ
3. **ç»˜åˆ¶æ¸å˜èƒŒæ™¯** - ä½¿ç”¨çº¿æ€§æ¸å˜å¡«å……åœ†è§’çŸ©å½¢
4. **ç»˜åˆ¶è¾¹æ¡†** - ç»˜åˆ¶å½©è‰²åœ†è§’è¾¹æ¡†
5. **å åŠ äºŒç»´ç ** - å°†äºŒç»´ç å›¾åƒç»˜åˆ¶åˆ°ç”»å¸ƒä¸Š
6. **æ·»åŠ æ–‡å­—** - åœ¨åº•éƒ¨æ·»åŠ æ ‡è¯†æ–‡å­—
7. **å¯¼å‡ºå›¾ç‰‡** - è½¬æ¢ä¸º PNG Buffer

## ä¿®æ”¹çš„æ–‡ä»¶

### 1. server/bot/handlers/energy.js
```javascript
// å¼•å…¥ç¾åŒ–å·¥å…·
const { generateEnergyQRCode } = require('../utils/qrCodeGenerator');

// ä½¿ç”¨ç¾åŒ–äºŒç»´ç 
const qrBuffer = await generateEnergyQRCode(walletAddress);
```

### 2. server/bot/handlers/swap.js
```javascript
// å¼•å…¥ç¾åŒ–å·¥å…·
const { generateSwapQRCode } = require('../utils/qrCodeGenerator');

// ä½¿ç”¨ç¾åŒ–äºŒç»´ç 
const qrBuffer = await generateSwapQRCode(walletAddress);
```

### 3. server/bot/handlers/payment.js
```javascript
// å¼•å…¥ç¾åŒ–å·¥å…·
const { generatePaymentQRCode } = require('../utils/qrCodeGenerator');

// ä½¿ç”¨ç¾åŒ–äºŒç»´ç 
const qrBuffer = await generatePaymentQRCode(paymentUrl);
```

## é™çº§å¤„ç†

å¦‚æœç¾åŒ–è¿‡ç¨‹å¤±è´¥ï¼ˆä¾‹å¦‚ canvas åº“æœªå®‰è£…ï¼‰ï¼Œä¼šè‡ªåŠ¨é™çº§ä¸ºæ™®é€šäºŒç»´ç ï¼š
```javascript
catch (error) {
  console.error('ç”Ÿæˆç¾åŒ–äºŒç»´ç å¤±è´¥:', error);
  // é™çº§ï¼šè¿”å›æ™®é€šäºŒç»´ç 
  return QRCode.toBuffer(data, {
    width: size,
    margin: 1,
    color: {
      dark: qrColor,
      light: '#FFFFFF'
    }
  });
}
```

## è‡ªå®šä¹‰é…ç½®

å¦‚éœ€ä¿®æ”¹æ ·å¼ï¼Œç¼–è¾‘ `server/bot/utils/qrCodeGenerator.js`ï¼š

### ä¿®æ”¹èƒ½é‡ç§Ÿèµé…è‰²
```javascript
async function generateEnergyQRCode(address) {
  return generateStyledQRCode(address, {
    borderColor: '#10B981',    // è¾¹æ¡†é¢œè‰²
    gradientStart: '#D1FAE5',  // æ¸å˜èµ·å§‹
    gradientEnd: '#FFFFFF',    // æ¸å˜ç»“æŸ
    logoText: 'âš¡ èƒ½é‡ç§Ÿèµ'     // åº•éƒ¨æ–‡å­—
  });
}
```

### ä¿®æ”¹é—ªå…‘æœåŠ¡é…è‰²
```javascript
async function generateSwapQRCode(address) {
  return generateStyledQRCode(address, {
    borderColor: '#3B82F6',    // è¾¹æ¡†é¢œè‰²
    gradientStart: '#DBEAFE',  // æ¸å˜èµ·å§‹
    gradientEnd: '#FFFFFF',    // æ¸å˜ç»“æŸ
    logoText: 'ğŸ”„ USDT é—ªå…‘'   // åº•éƒ¨æ–‡å­—
  });
}
```

### ä¿®æ”¹æ”¯ä»˜é…è‰²
```javascript
async function generatePaymentQRCode(paymentUrl) {
  return generateStyledQRCode(paymentUrl, {
    borderColor: '#F59E0B',    // è¾¹æ¡†é¢œè‰²
    gradientStart: '#FEF3C7',  // æ¸å˜èµ·å§‹
    gradientEnd: '#FFFFFF',    // æ¸å˜ç»“æŸ
    logoText: 'ğŸ’³ æ‰«ç æ”¯ä»˜'     // åº•éƒ¨æ–‡å­—
  });
}
```

## æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ Canvas åœ¨æœåŠ¡ç«¯ç”Ÿæˆï¼Œä¸å½±å“å®¢æˆ·ç«¯æ€§èƒ½
- äºŒç»´ç ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤ç”Ÿæˆ
- é™çº§æœºåˆ¶ç¡®ä¿æœåŠ¡ç¨³å®šæ€§

## æµ‹è¯•æ­¥éª¤

1. **é‡å¯ Bot æœåŠ¡**
```bash
npm start
# æˆ–
pm2 restart telegram-bot
```

2. **æµ‹è¯•èƒ½é‡ç§Ÿèµ**
- ç‚¹å‡»"èƒ½é‡ç§Ÿèµ"æŒ‰é’®
- æŸ¥çœ‹äºŒç»´ç æ˜¯å¦æœ‰ç»¿è‰²è¾¹æ¡†å’Œæ¸å˜èƒŒæ™¯

3. **æµ‹è¯•é—ªå…‘æœåŠ¡**
- ç‚¹å‡»"é—ªå…‘æœåŠ¡"æŒ‰é’®
- æŸ¥çœ‹äºŒç»´ç æ˜¯å¦æœ‰è“è‰²è¾¹æ¡†å’Œæ¸å˜èƒŒæ™¯

4. **æµ‹è¯•æ”¯ä»˜**
- åˆ›å»ºä¸€ä¸ªæ”¯ä»˜è®¢å•
- æŸ¥çœ‹æ”¯ä»˜äºŒç»´ç æ˜¯å¦æœ‰æ©™è‰²è¾¹æ¡†å’Œæ¸å˜èƒŒæ™¯

## æ³¨æ„äº‹é¡¹

1. **Canvas ä¾èµ–**
   - éœ€è¦å®‰è£… `canvas` åº“
   - Windows ç³»ç»Ÿå¯èƒ½éœ€è¦é¢å¤–é…ç½®
   - å¦‚æœå®‰è£…å¤±è´¥ï¼Œä¼šè‡ªåŠ¨é™çº§ä¸ºæ™®é€šäºŒç»´ç 

2. **å›¾ç‰‡å¤§å°**
   - ç¾åŒ–åçš„å›¾ç‰‡ç•¥å¤§äºæ™®é€šäºŒç»´ç 
   - ä½†ä»åœ¨ Telegram çš„é™åˆ¶èŒƒå›´å†…

3. **é¢œè‰²é€‰æ‹©**
   - è¾¹æ¡†é¢œè‰²åº”ä¸åŠŸèƒ½ä¸»é¢˜åŒ¹é…
   - æ¸å˜èƒŒæ™¯ä¸å®œè¿‡æ·±ï¼Œé¿å…å½±å“æ‰«ç 

4. **æ–‡å­—æ˜¾ç¤º**
   - åº•éƒ¨æ–‡å­—ä½¿ç”¨ Emoji + ä¸­æ–‡
   - å­—ä½“å¤§å°å’Œé¢œè‰²å¯è‡ªå®šä¹‰

## æ•ˆæœå¯¹æ¯”

### ä¹‹å‰
- â¬œ çº¯ç™½èƒŒæ™¯
- â¬œ æ— è¾¹æ¡†
- â¬œ æ— æ ‡è¯†

### ç°åœ¨
- âœ… æ¸å˜èƒŒæ™¯
- âœ… å½©è‰²åœ†è§’è¾¹æ¡†
- âœ… åº•éƒ¨æ ‡è¯†æ–‡å­—
- âœ… ä¸åŒåœºæ™¯ä¸åŒé…è‰²

## ç”¨æˆ·åé¦ˆ

ç¾åŒ–åçš„äºŒç»´ç ï¼š
- æ›´åŠ ç¾è§‚ä¸“ä¸š
- æ›´å®¹æ˜“è¯†åˆ«åŠŸèƒ½
- æå‡ç”¨æˆ·ä½“éªŒ
- å¢å¼ºå“ç‰Œå½¢è±¡

## åç»­ä¼˜åŒ–

å¯ä»¥è€ƒè™‘ï¼š
1. æ·»åŠ  Logo å›¾æ ‡åˆ°äºŒç»´ç ä¸­å¿ƒ
2. æ”¯æŒè‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆ
3. æ·»åŠ åŠ¨ç”»æ•ˆæœï¼ˆGIFï¼‰
4. æ”¯æŒå¤šè¯­è¨€æ–‡å­—
