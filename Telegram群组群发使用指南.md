# Telegram 群组群发使用指南

## 功能说明

系统支持向 Telegram 群组/频道发送群发消息，Bot 会自动记录加入的群组信息，无需手动输入 Chat ID。

---

## 使用步骤

### 1. 将 Bot 添加到群组

**添加到群组：**
1. 打开 Telegram 群组
2. 点击群组名称 → **添加成员**
3. 搜索你的 Bot 用户名
4. 添加 Bot 到群组

**添加到频道：**
1. 打开 Telegram 频道
2. 点击频道名称 → **管理员**
3. 点击 **添加管理员**
4. 搜索你的 Bot 用户名
5. 添加 Bot 为管理员（至少需要"发送消息"权限）

### 2. 激活 Bot 记录

Bot 添加到群组后，需要触发一次消息才能记录群组信息：

**方法一：在群组中发送消息**
- 在群组中发送任意消息（如：`/start`）
- Bot 会自动记录群组信息

**方法二：Bot 自动记录**
- Bot 被添加时会自动记录
- 如果没有记录，在群组中发送一条消息即可

### 3. 创建群发消息

1. 进入 **Telegram 管理** → **群发消息**
2. 点击 **+ 创建群发**
3. 填写群发信息：
   - **群发标题**：例如"系统维护通知"
   - **内容类型**：文本/图片/视频/文档
   - **目标用户**：选择 **👨‍👩‍👧‍👦 群组**
4. **选择群组/频道**：
   - 勾选要发送的群组
   - 可以选择多个群组
   - 显示群组名称、类型、Bot 权限、成员数
5. 填写消息内容
6. 点击 **保存并发送** 或 **保存为草稿**

---

## 群组信息说明

### 群组类型

- **📢 频道**：单向广播频道
- **👥 超级群组**：大型群组（超过 200 人）
- **👥 群组**：普通群组

### Bot 权限

- **👑 管理员**：Bot 是群组管理员，拥有完整权限
- **👤 成员**：Bot 是普通成员，只能发送消息

### 群组状态

系统只显示 **活跃** 的群组（Bot 未被移除）。

---

## 高级功能

### 1. 手动输入 Chat ID

如果群组未自动记录，可以手动输入 Chat ID：

1. 在群组选择器下方，点击 **或手动输入 Chat ID**
2. 每行输入一个 Chat ID
3. Chat ID 格式：`-1001234567890`（负数，以 -100 开头）

**如何获取 Chat ID：**
- 使用 [@userinfobot](https://t.me/userinfobot)
- 将 Bot 转发到群组，Bot 会回复 Chat ID
- 或使用其他 Telegram ID 查询工具

### 2. 定时群发

支持定时发送到群组：

1. 在群发表单中设置 **定时发送时间**
2. 系统会在指定时间自动发送

### 3. 重复群发

支持按间隔重复发送到群组：

1. 勾选 **启用重复发送**
2. 设置 **重复间隔**（小时）
3. 设置 **最大重复次数**（0 = 无限）
4. 系统会自动重复发送

---

## 常见问题

### Q: 为什么看不到群组列表？

**A:** 可能的原因：
1. Bot 未被添加到任何群组
2. Bot 被添加后未触发消息记录
3. Bot 已被移除

**解决方法：**
1. 确认 Bot 在群组中
2. 在群组中发送一条消息（如 `/start`）
3. 刷新群发页面

### Q: 群发失败怎么办？

**A:** 检查以下几点：
1. **Bot 权限**：确保 Bot 有发送消息的权限
2. **群组状态**：确保群组未被封禁
3. **消息格式**：检查消息内容是否符合 Telegram 规范
4. **按钮 URL**：如果有按钮，确保 URL 格式正确

查看详细错误：
- 点击群发消息的 **详情** 按钮
- 查看失败详情和错误原因

### Q: 可以同时发送到多个群组吗？

**A:** 可以！勾选多个群组即可同时发送。

### Q: 群发会 @ 所有人吗？

**A:** 不会。群发只是在群组中发送一条普通消息，不会 @ 任何人。

### Q: 频道和群组有什么区别？

**A:** 
- **频道**：单向广播，只有管理员可以发消息
- **群组**：双向交流，所有成员都可以发消息

对于群发功能，两者使用方式相同。

### Q: Bot 需要什么权限？

**A:** 
- **群组**：Bot 只需要是成员即可发送消息
- **频道**：Bot 必须是管理员，且有"发送消息"权限

### Q: 如何移除不需要的群组？

**A:** 
1. 从群组中移除 Bot
2. 系统会自动标记为"不活跃"
3. 不活跃的群组不会显示在列表中

---

## 最佳实践

### 1. 测试发送

在正式群发前，建议：
1. 创建一个测试群组
2. 先发送到测试群组
3. 确认格式和内容无误
4. 再发送到正式群组

### 2. 消息格式

- 使用 HTML 格式化消息（`<b>加粗</b>`、`<code>代码</code>`）
- 添加清晰的标题和分段
- 使用 emoji 增加可读性
- 避免过长的消息（建议 < 1000 字）

### 3. 发送频率

- 避免频繁群发（建议间隔 > 1 小时）
- 使用定时发送功能，选择合适的时间
- 重要通知可以重复发送 2-3 次

### 4. 按钮使用

- 添加有用的按钮（如"查看详情"、"联系客服"）
- 确保按钮 URL 正确
- 避免过多按钮（建议 < 6 个）

---

## 技术说明

### 自动记录机制

Bot 通过监听以下事件自动记录群组：

1. **my_chat_member**：Bot 被添加/移除
2. **message**：群组中的消息
3. **channel_post**：频道中的帖子

记录的信息包括：
- Chat ID
- 群组名称
- 群组类型
- Bot 权限
- 成员数量（如果可获取）

### 发送机制

群组群发直接发送到群组的 Chat ID，而不是发送给群里的每个用户：

```javascript
// 发送到群组
await bot.telegram.sendMessage(groupChatId, content, options);

// 而不是发送给每个用户
// for (const user of groupUsers) {
//   await bot.telegram.sendMessage(user.telegramId, content, options);
// }
```

这样可以：
- 减少 API 调用次数
- 避免触发限流
- 提高发送效率

---

## 相关文档

- [Telegram 群发系统使用指南](./Telegram_Bot_群发系统使用指南.md)
- [Telegram 群发定时重复功能](./Telegram群发定时重复功能使用指南.md)
- [Telegram Bot 快速启动指南](./Telegram_Bot_快速启动指南.md)

---

**最后更新：** 2026-02-08  
**版本：** v1.0.0
