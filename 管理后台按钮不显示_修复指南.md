# ç®¡ç†åå°æŒ‰é’®ä¸æ˜¾ç¤º - ä¿®å¤æŒ‡å—

## ğŸ” é—®é¢˜è¯Šæ–­

ä½ çš„æƒ…å†µï¼š
- âœ… åˆå§‹åŒ–è„šæœ¬è¿è¡ŒæˆåŠŸ
- âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸï¼ˆkailsayï¼‰
- âŒ ç™»å½•åçœ‹ä¸åˆ°"ç®¡ç†åå°"æŒ‰é’®

## ğŸ¯ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥è´¦å·è§’è‰²

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š
```bash
node server/scripts/checkAdmin.js
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ… æ‰¾åˆ° 1 ä¸ªç®¡ç†å‘˜è´¦å·ï¼š

ç®¡ç†å‘˜ 1:
  ç”¨æˆ·å: kailsay
  é‚®ç®±: kailsay@gmail.com
  è§’è‰²: admin  â† åº”è¯¥æ˜¾ç¤º admin
```

å¦‚æœè§’è‰²ä¸æ˜¯ `admin`ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚

---

### æ­¥éª¤ 2ï¼šä¿®å¤ç®¡ç†å‘˜è§’è‰²

è¿è¡Œä¿®å¤è„šæœ¬ï¼š
```bash
node server/scripts/fixAdminRole.js
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. æŸ¥æ‰¾ç”¨æˆ· `kailsay`
2. æ£€æŸ¥å½“å‰è§’è‰²
3. å¦‚æœä¸æ˜¯ `admin`ï¼Œè‡ªåŠ¨ä¿®æ”¹ä¸º `admin`
4. éªŒè¯ä¿®æ”¹ç»“æœ

---

### æ­¥éª¤ 3ï¼šé‡æ–°ç™»å½•

**é‡è¦ï¼šå¿…é¡»é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆï¼**

1. **é€€å‡ºç™»å½•**
   - ç‚¹å‡»å³ä¸Šè§’çš„é€€å‡ºæŒ‰é’®
   - æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

2. **é‡æ–°ç™»å½•**
   - ç”¨æˆ·åï¼š`kailsay`
   - å¯†ç ï¼š`specter1234`

3. **æŸ¥çœ‹å¯¼èˆªæ **
   - ç™»å½•åï¼Œåœ¨å³ä¸Šè§’ç”¨æˆ·èœå•æ—è¾¹
   - åº”è¯¥èƒ½çœ‹åˆ°è“è‰²çš„"ç®¡ç†åå°"æŒ‰é’®

---

## ğŸ› å¯èƒ½çš„åŸå› 

### åŸå›  1ï¼šToken ç¼“å­˜é—®é¢˜

**ç—‡çŠ¶ï¼š**
- è§’è‰²å·²ç»æ˜¯ `admin`
- ä½†ç™»å½•åä»çœ‹ä¸åˆ°æŒ‰é’®

**åŸå› ï¼š**
- æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„ token
- Token ä¸­çš„ role ä¿¡æ¯æ˜¯æ—§çš„

**è§£å†³æ–¹æ³•ï¼š**

**æ–¹æ³•ä¸€ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆæ¨èï¼‰**
1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»"Application"ï¼ˆåº”ç”¨ï¼‰æ ‡ç­¾
3. å·¦ä¾§æ‰¾åˆ°"Local Storage"
4. åˆ é™¤ `token` é¡¹
5. åˆ·æ–°é¡µé¢
6. é‡æ–°ç™»å½•

**æ–¹æ³•äºŒï¼šä½¿ç”¨æ— ç—•æ¨¡å¼**
1. æ‰“å¼€æ— ç—•/éšç§æµè§ˆçª—å£
2. è®¿é—®ç½‘ç«™
3. ç™»å½•

**æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨æ¸…é™¤**
åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æ‰§è¡Œï¼š
```javascript
localStorage.removeItem('token');
location.reload();
```

---

### åŸå›  2ï¼šå‰ç«¯ä»£ç æœªæ›´æ–°

**ç—‡çŠ¶ï¼š**
- è§’è‰²æ˜¯ `admin`
- å·²ç»é‡æ–°ç™»å½•
- ä»ç„¶çœ‹ä¸åˆ°æŒ‰é’®

**è§£å†³æ–¹æ³•ï¼š**

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - Ctrl + Shift + Delete
   - æ¸…é™¤ç¼“å­˜å’Œ Cookie

2. **å¼ºåˆ¶åˆ·æ–°é¡µé¢**
   - Ctrl + F5ï¼ˆWindowsï¼‰
   - Cmd + Shift + Rï¼ˆMacï¼‰

3. **é‡æ–°æ„å»ºå‰ç«¯**ï¼ˆå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼‰
   ```bash
   cd /www/wwwroot/your-domain
   npm run build
   ```

---

### åŸå›  3ï¼šåç«¯æœªè¿”å› role å­—æ®µ

**ç—‡çŠ¶ï¼š**
- ç™»å½•æˆåŠŸ
- ä½†å‰ç«¯æ”¶åˆ°çš„ç”¨æˆ·ä¿¡æ¯ä¸­æ²¡æœ‰ role

**è¯Šæ–­æ–¹æ³•ï¼š**

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ°"Network"ï¼ˆç½‘ç»œï¼‰æ ‡ç­¾
3. é‡æ–°ç™»å½•
4. æ‰¾åˆ° `/api/auth/login` è¯·æ±‚
5. æŸ¥çœ‹å“åº”å†…å®¹

**æ­£ç¡®çš„å“åº”åº”è¯¥åŒ…å«ï¼š**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "username": "kailsay",
    "email": "kailsay@gmail.com",
    "role": "admin"  â† å¿…é¡»æœ‰è¿™ä¸ªå­—æ®µ
  }
}
```

å¦‚æœæ²¡æœ‰ `role` å­—æ®µï¼Œéœ€è¦é‡å¯åç«¯ï¼š
```bash
pm2 restart easypay-backend
```

---

## ğŸ”§ æ‰‹åŠ¨ä¿®å¤æ•°æ®åº“

å¦‚æœè„šæœ¬æ— æ³•è¿è¡Œï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“ï¼š

### ä½¿ç”¨ MongoDB å‘½ä»¤è¡Œ

```bash
# è¿æ¥æ•°æ®åº“
mongosh

# åˆ‡æ¢åˆ°æ•°æ®åº“
use easypay

# æŸ¥çœ‹ç”¨æˆ·
db.users.findOne({ username: 'kailsay' })

# ä¿®æ”¹è§’è‰²ä¸º admin
db.users.updateOne(
  { username: 'kailsay' },
  { $set: { role: 'admin' } }
)

# éªŒè¯
db.users.findOne({ username: 'kailsay' })

# é€€å‡º
exit
```

### ä½¿ç”¨å®å¡” MongoDB ç®¡ç†å™¨

1. ç‚¹å‡»"è½¯ä»¶å•†åº—" â†’ "MongoDB" â†’ "è®¾ç½®" â†’ "ç®¡ç†"
2. é€‰æ‹©æ•°æ®åº“ï¼š`easypay`
3. é€‰æ‹©é›†åˆï¼š`users`
4. æ‰¾åˆ°ç”¨æˆ· `kailsay`
5. ç¼–è¾‘æ–‡æ¡£
6. å°† `role` å­—æ®µæ”¹ä¸º `"admin"`
7. ä¿å­˜

---

## âœ… éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥æ•°æ®åº“

```bash
node server/scripts/checkAdmin.js
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
âœ… æ‰¾åˆ° 1 ä¸ªç®¡ç†å‘˜è´¦å·ï¼š
  ç”¨æˆ·å: kailsay
  è§’è‰²: admin
```

### 2. æ£€æŸ¥ç™»å½•å“åº”

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ°"Network"æ ‡ç­¾
3. ç™»å½•
4. æŸ¥çœ‹ `/api/auth/login` å“åº”
5. ç¡®è®¤ `user.role` æ˜¯ `"admin"`

### 3. æ£€æŸ¥å‰ç«¯çŠ¶æ€

ç™»å½•åï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æ‰§è¡Œï¼š
```javascript
// æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯
console.log(JSON.parse(localStorage.getItem('token')));

// æˆ–è€…æŸ¥çœ‹é¡µé¢ä¸Šçš„ç”¨æˆ·ä¿¡æ¯
// åº”è¯¥èƒ½çœ‹åˆ° role: "admin"
```

### 4. æŸ¥çœ‹ç®¡ç†åå°æŒ‰é’®

ç™»å½•åï¼Œåœ¨å¯¼èˆªæ å³ä¸Šè§’åº”è¯¥èƒ½çœ‹åˆ°ï¼š
```
[ç”¨æˆ·èœå•] [ç®¡ç†åå°] [é€€å‡º]
            â†‘ è¿™ä¸ªæŒ‰é’®
```

---

## ğŸ¯ å®Œæ•´ä¿®å¤æµç¨‹

```bash
# 1. æ£€æŸ¥è´¦å·è§’è‰²
node server/scripts/checkAdmin.js

# 2. å¦‚æœè§’è‰²ä¸æ˜¯ adminï¼Œè¿è¡Œä¿®å¤è„šæœ¬
node server/scripts/fixAdminRole.js

# 3. é‡å¯åç«¯ï¼ˆç¡®ä¿ä»£ç ç”Ÿæ•ˆï¼‰
pm2 restart easypay-backend

# 4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# åœ¨æµè§ˆå™¨ä¸­æŒ‰ Ctrl + Shift + Delete

# 5. é‡æ–°ç™»å½•
# è®¿é—®ç½‘ç«™ï¼Œä½¿ç”¨è´¦å·å¯†ç ç™»å½•

# 6. éªŒè¯
# åº”è¯¥èƒ½çœ‹åˆ°"ç®¡ç†åå°"æŒ‰é’®
```

---

## ğŸ“Š è°ƒè¯•ä¿¡æ¯æ”¶é›†

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ•ˆï¼Œè¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š

### 1. æ•°æ®åº“ä¿¡æ¯
```bash
node server/scripts/checkAdmin.js
```

### 2. ç™»å½•å“åº”
- æ‰“å¼€ F12 â†’ Network
- ç™»å½•
- å¤åˆ¶ `/api/auth/login` çš„å“åº”å†…å®¹

### 3. æµè§ˆå™¨æ§åˆ¶å°
- æ‰“å¼€ F12 â†’ Console
- æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- æ‰§è¡Œï¼š`console.log(localStorage.getItem('token'))`

### 4. åç«¯æ—¥å¿—
```bash
pm2 logs easypay-backend --lines 50
```

---

## ğŸ’¡ é¢„é˜²æªæ–½

### 1. åˆ›å»ºç®¡ç†å‘˜æ—¶ç¡®è®¤è§’è‰²

åˆå§‹åŒ–è„šæœ¬ä¼šæ˜¾ç¤ºï¼š
```
âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ
   ç”¨æˆ·å: kailsay
   é‚®ç®±: kailsay@gmail.com
   å¯†ç : specter1234
   è§’è‰²: admin  â† ç¡®è®¤è¿™é‡Œæ˜¾ç¤º admin
```

### 2. ç™»å½•åæ£€æŸ¥ç”¨æˆ·ä¿¡æ¯

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// è§£ç  JWT token æŸ¥çœ‹è§’è‰²
const token = localStorage.getItem('token');
const payload = JSON.parse(atob(token.split('.')[1]));
console.log('ç”¨æˆ·è§’è‰²:', payload.role);
```

### 3. å®šæœŸå¤‡ä»½æ•°æ®åº“

```bash
mongodump --db easypay --out /backup/easypay_$(date +%Y%m%d)
```

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

ä¿®å¤æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š

1. âœ… ç™»å½•åå¯¼èˆªæ æ˜¾ç¤º"ç®¡ç†åå°"æŒ‰é’®
2. âœ… ç‚¹å‡»æŒ‰é’®è·³è½¬åˆ° `/admin` é¡µé¢
3. âœ… å¯ä»¥è®¿é—®æ‰€æœ‰ç®¡ç†åŠŸèƒ½ï¼š
   - ç³»ç»Ÿè®¾ç½®
   - é’±åŒ…é…ç½®
   - è´¢åŠ¡ç®¡ç†
   - ç”¨æˆ·ç®¡ç†
   - ç­‰ç­‰

---

**ä¿®å¤æŒ‡å—ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-03  
**é€‚ç”¨è´¦å·ï¼š** kailsay
