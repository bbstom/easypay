# 商品名称随机化 - 完成报告

## 📋 需求说明

将支付订单的商品名称从固定的 "OneDrive" 改为从多个名称中随机选择。

## ✅ 已完成的修改

### 修改文件
**文件：** `server/routes/payments.js`

### 实现方式

```javascript
// 随机商品名称列表
const productNames = ['MongoDB Atlas', 'AWS Lambda', 'Vercel', 'CDN', 'OneDrive'];
const randomProductName = productNames[Math.floor(Math.random() * productNames.length)];

const paymentOrder = await paymentService.createPaymentOrder({
  orderId: orderId,
  amount: req.body.totalCNY,
  payType,
  paymentMethod,
  subject: randomProductName,
  body: randomProductName
});
```

### 商品名称列表

每次创建支付订单时，会从以下名称中随机选择一个：

1. **MongoDB Atlas** - 云数据库服务
2. **AWS Lambda** - 无服务器计算服务
3. **Vercel** - 前端部署平台
4. **CDN** - 内容分发网络
5. **OneDrive** - 云存储服务

## 🎯 功能特点

### 1. 真随机
- 使用 `Math.random()` 实现真随机选择
- 每次创建订单都会重新随机

### 2. 均匀分布
- 每个商品名称被选中的概率相同（20%）
- 不会出现连续相同的情况（概率很低）

### 3. 易于维护
- 商品名称集中在一个数组中
- 需要添加/删除名称时，只需修改数组即可

## 📊 使用场景

### 支付订单创建
当用户创建支付订单时，系统会：
1. 从商品名称列表中随机选择一个
2. 将选中的名称作为 `subject` 和 `body` 发送给支付平台
3. 支付平台会在支付页面显示该商品名称

### 示例

**订单 1：**
```json
{
  "subject": "AWS Lambda",
  "body": "AWS Lambda"
}
```

**订单 2：**
```json
{
  "subject": "Vercel",
  "body": "Vercel"
}
```

**订单 3：**
```json
{
  "subject": "MongoDB Atlas",
  "body": "MongoDB Atlas"
}
```

## 🔧 如何修改商品名称列表

如果需要添加或删除商品名称，编辑 `server/routes/payments.js` 文件：

```javascript
// 修改这个数组
const productNames = [
  'MongoDB Atlas',
  'AWS Lambda', 
  'Vercel',
  'CDN',
  'OneDrive',
  // 添加新的商品名称
  'GitHub Pro',
  'Docker Hub'
];
```

## 📝 注意事项

### 1. 商品名称长度
- 建议商品名称不要太长（建议 20 字符以内）
- 避免使用特殊字符，可能影响支付平台显示

### 2. 商品名称选择
- 选择常见的云服务/技术服务名称
- 避免使用敏感或容易引起误解的名称

### 3. 支付平台兼容性
- 确保支付平台支持中文/英文商品名称
- 某些支付平台可能对商品名称有长度限制

## 🧪 测试建议

### 1. 创建多个订单
```bash
# 创建 10 个测试订单，观察商品名称是否随机
for i in {1..10}; do
  curl -X POST http://localhost:3000/api/payments/create \
    -H "Content-Type: application/json" \
    -d '{"amount": 100, "currency": "USDT"}'
done
```

### 2. 检查数据库
```javascript
// 查看订单中的商品名称分布
db.payments.aggregate([
  {
    $group: {
      _id: "$subject",
      count: { $sum: 1 }
    }
  }
])
```

### 3. 查看支付页面
- 创建订单后，检查支付页面显示的商品名称
- 确认支付平台正确显示随机的商品名称

## 🔄 部署说明

### 开发环境
修改后会自动重启（nodemon），无需手动操作。

### 生产环境
```bash
# 重启后端服务
pm2 restart easypay-backend

# 查看日志
pm2 logs easypay-backend
```

## ✅ 验证清单

- [x] 代码修改完成
- [x] 商品名称列表包含 5 个名称
- [x] 使用 Math.random() 实现随机选择
- [x] subject 和 body 都使用随机名称
- [x] 代码易于维护和扩展

## 📊 预期效果

### 修改前
所有订单的商品名称都是：`OneDrive`

### 修改后
订单的商品名称会随机显示为：
- MongoDB Atlas
- AWS Lambda
- Vercel
- CDN
- OneDrive

每个名称出现的概率约为 20%。

## 🎉 完成

商品名称随机化功能已实现！每次创建支付订单时，系统会自动从 5 个商品名称中随机选择一个。

---

**实施时间：** 2026-02-03  
**修改文件：** `server/routes/payments.js`  
**影响范围：** 支付订单创建流程
