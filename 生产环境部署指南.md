# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx (Web æœåŠ¡å™¨)                    â”‚
â”‚  - é™æ€æ–‡ä»¶æœåŠ¡ (å‰ç«¯)                                   â”‚
â”‚  - åå‘ä»£ç† (API è¯·æ±‚)                                   â”‚
â”‚  - SSL/TLS è¯ä¹¦                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Node.js (åç«¯æœåŠ¡)                      â”‚
â”‚  - Express API æœåŠ¡å™¨                                    â”‚
â”‚  - ç«¯å£: 3000                                            â”‚
â”‚  - PM2 è¿›ç¨‹ç®¡ç†                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MongoDB (æ•°æ®åº“)                        â”‚
â”‚  - ç«¯å£: 27017                                           â”‚
â”‚  - æ•°æ®æŒä¹…åŒ–                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šå‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

#### 1.1 ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿï¼š** Ubuntu 20.04+ / CentOS 7+ / Windows Server
- **å†…å­˜ï¼š** è‡³å°‘ 2GB RAM
- **ç¡¬ç›˜ï¼š** è‡³å°‘ 20GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œï¼š** å…¬ç½‘ IP å’ŒåŸŸå

#### 1.2 å®‰è£…å¿…è¦è½¯ä»¶

**Ubuntu/Debian:**
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£… MongoDB
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
sudo apt update
sudo apt install -y mongodb-org

# å¯åŠ¨ MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod

# å®‰è£… Nginx
sudo apt install -y nginx

# å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
sudo npm install -g pm2

# å®‰è£… Git
sudo apt install -y git
```

**CentOS/RHEL:**
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo yum update -y

# å®‰è£… Node.js 18.x
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# å®‰è£… MongoDB
sudo tee /etc/yum.repos.d/mongodb-org-6.0.repo <<EOF
[mongodb-org-6.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/\$releasever/mongodb-org/6.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc
EOF

sudo yum install -y mongodb-org
sudo systemctl start mongod
sudo systemctl enable mongod

# å®‰è£… Nginx
sudo yum install -y nginx

# å®‰è£… PM2
sudo npm install -g pm2

# å®‰è£… Git
sudo yum install -y git
```

---

### æ­¥éª¤ 2ï¼šéƒ¨ç½²ä»£ç 

#### 2.1 å…‹éš†ä»£ç 

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www
cd /var/www

# å…‹éš†ä»£ç ï¼ˆæˆ–ä¸Šä¼ ä»£ç ï¼‰
sudo git clone <your-repo-url> easypay
cd easypay

# æˆ–è€…ä½¿ç”¨ scp/ftp ä¸Šä¼ ä»£ç 
# scp -r ./easypay user@server:/var/www/
```

#### 2.2 å®‰è£…ä¾èµ–

```bash
cd /var/www/easypay

# å®‰è£… Node.js ä¾èµ–
npm install --production
```

#### 2.3 é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**ç”Ÿäº§ç¯å¢ƒ .env é…ç½®ï¼š**
```env
# ç¯å¢ƒ
NODE_ENV=production

# æœåŠ¡å™¨é…ç½®
PORT=3000

# MongoDB é…ç½®
MONGODB_URI=mongodb://localhost:27017/easypay

# JWT å¯†é’¥ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# ä¸»å¯†é’¥ï¼ˆç”¨äºåŠ å¯†é’±åŒ…ç§é’¥ï¼Œè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
MASTER_KEY=your-super-secret-master-key-change-this-in-production

# å‰ç«¯ URLï¼ˆç”¨äº CORSï¼‰
FRONTEND_URL=https://your-domain.com

# æ”¯ä»˜å›è°ƒ URL
PAYMENT_CALLBACK_URL=https://your-domain.com/api/payments/notify
```

**ç”Ÿæˆå®‰å…¨çš„å¯†é’¥ï¼š**
```bash
# ç”Ÿæˆ JWT_SECRET
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# ç”Ÿæˆ MASTER_KEY
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

---

### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–æ•°æ®åº“

#### 3.1 è¿è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
cd /var/www/easypay

# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
node server/scripts/initDatabase.js
```

**æŒ‰æç¤ºè¾“å…¥ï¼š**
- ç®¡ç†å‘˜ç”¨æˆ·åï¼ˆé»˜è®¤ï¼šadminï¼‰
- ç®¡ç†å‘˜é‚®ç®±ï¼ˆé»˜è®¤ï¼šadmin@example.comï¼‰
- ç®¡ç†å‘˜å¯†ç ï¼ˆé»˜è®¤ï¼šadmin123ï¼‰
- ç½‘ç«™åç§°ï¼ˆé»˜è®¤ï¼šFastPayï¼‰

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¡ è¿æ¥æ•°æ®åº“...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ åˆ›å»ºç®¡ç†å‘˜è´¦å·
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç®¡ç†å‘˜ç”¨æˆ·å (é»˜è®¤: admin): admin
ç®¡ç†å‘˜é‚®ç®± (é»˜è®¤: admin@example.com): admin@yourdomain.com
ç®¡ç†å‘˜å¯†ç  (é»˜è®¤: admin123): YourSecurePassword123

âœ… ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ
   ç”¨æˆ·å: admin
   é‚®ç®±: admin@yourdomain.com
   å¯†ç : YourSecurePassword123
   âš ï¸  è¯·å¦¥å–„ä¿ç®¡ç®¡ç†å‘˜å¯†ç ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš™ï¸  åˆ›å»ºç³»ç»Ÿé…ç½®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç½‘ç«™åç§° (é»˜è®¤: FastPay): MyPaymentPlatform

âœ… ç³»ç»Ÿé…ç½®åˆ›å»ºæˆåŠŸ
   ç½‘ç«™åç§°: MyPaymentPlatform
   USDT æ±‡ç‡: 7.35 CNY
   TRX æ±‡ç‡: 1.08 CNY
   æœåŠ¡è´¹ (USDT): 5 CNY
   æœåŠ¡è´¹ (TRX): 2 CNY

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç®¡ç†åå°åœ°å€: https://your-domain.com/login
ç®¡ç†å‘˜è´¦å·: admin
ç®¡ç†å‘˜å¯†ç : YourSecurePassword123

âš ï¸  è¯·ç«‹å³ç™»å½•å¹¶ä¿®æ”¹é»˜è®¤å¯†ç ï¼
```

#### 3.2 éªŒè¯æ•°æ®åº“

```bash
# è¿æ¥ MongoDB
mongosh

# åˆ‡æ¢åˆ°æ•°æ®åº“
use easypay

# æŸ¥çœ‹é›†åˆ
show collections

# æŸ¥çœ‹ç®¡ç†å‘˜è´¦å·
db.users.find({ role: 'admin' })

# æŸ¥çœ‹ç³»ç»Ÿé…ç½®
db.settings.find()

# é€€å‡º
exit
```

---

### æ­¥éª¤ 4ï¼šæ„å»ºå‰ç«¯

#### 4.1 æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
cd /var/www/easypay

# æ„å»ºå‰ç«¯
npm run build
```

**æ„å»ºå®Œæˆåï¼Œä¼šç”Ÿæˆ `dist` ç›®å½•ï¼ŒåŒ…å«ï¼š**
- `index.html` - å…¥å£æ–‡ä»¶
- `assets/` - JSã€CSSã€å›¾ç‰‡ç­‰é™æ€èµ„æº

#### 4.2 éªŒè¯æ„å»º

```bash
# æŸ¥çœ‹æ„å»ºäº§ç‰©
ls -lh dist/

# åº”è¯¥çœ‹åˆ°ï¼š
# index.html
# assets/
#   â”œâ”€â”€ index-xxxxx.js
#   â”œâ”€â”€ index-xxxxx.css
#   â””â”€â”€ ...
```

---

### æ­¥éª¤ 5ï¼šé…ç½® Nginx

#### 5.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

```bash
sudo nano /etc/nginx/sites-available/easypay
```

**Nginx é…ç½®å†…å®¹ï¼š**
```nginx
# ä¸Šæ¸¸åç«¯æœåŠ¡å™¨
upstream backend {
    server 127.0.0.1:3000;
    keepalive 64;
}

# HTTP æœåŠ¡å™¨ï¼ˆé‡å®šå‘åˆ° HTTPSï¼‰
server {
    listen 80;
    listen [::]:80;
    server_name your-domain.com www.your-domain.com;
    
    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

# HTTPS æœåŠ¡å™¨
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    # SSL è¯ä¹¦é…ç½®ï¼ˆä½¿ç”¨ Let's Encryptï¼‰
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # æ—¥å¿—
    access_log /var/log/nginx/easypay_access.log;
    error_log /var/log/nginx/easypay_error.log;
    
    # æ ¹ç›®å½•ï¼ˆå‰ç«¯é™æ€æ–‡ä»¶ï¼‰
    root /var/www/easypay/dist;
    index index.html;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json application/javascript;
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # API è¯·æ±‚ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # å‰ç«¯è·¯ç”±ï¼ˆSPAï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
}
```

#### 5.2 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/easypay /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

#### 5.3 é…ç½® SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

### æ­¥éª¤ 6ï¼šå¯åŠ¨åç«¯æœåŠ¡

#### 6.1 ä½¿ç”¨ PM2 å¯åŠ¨

```bash
cd /var/www/easypay

# å¯åŠ¨åç«¯æœåŠ¡
pm2 start server/index.js --name easypay-backend

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs easypay-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### 6.2 PM2 å¸¸ç”¨å‘½ä»¤

```bash
# é‡å¯æœåŠ¡
pm2 restart easypay-backend

# åœæ­¢æœåŠ¡
pm2 stop easypay-backend

# åˆ é™¤æœåŠ¡
pm2 delete easypay-backend

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show easypay-backend

# ç›‘æ§
pm2 monit
```

---

### æ­¥éª¤ 7ï¼šé…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian (UFW)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --reload
```

---

### æ­¥éª¤ 8ï¼šåç»­é…ç½®

#### 8.1 ç™»å½•ç®¡ç†åå°

è®¿é—®ï¼š`https://your-domain.com/login`

ä½¿ç”¨åˆå§‹åŒ–æ—¶åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•ã€‚

#### 8.2 å¿…è¦é…ç½®

**1. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç **
- è¿›å…¥"ç”¨æˆ·ä¸­å¿ƒ"
- ä¿®æ”¹å¯†ç 

**2. é…ç½®æ”¯ä»˜å¹³å°**
- è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "æ”¯ä»˜é…ç½®"
- å¡«å†™å•†æˆ·IDã€APIå¯†é’¥
- é…ç½®å›è°ƒåœ°å€ï¼š`https://your-domain.com/api/payments/notify`

**3. æ·»åŠ ä»£ä»˜é’±åŒ…**
- è¿›å…¥"ä»£ä»˜ç³»ç»Ÿ" â†’ "é’±åŒ…é…ç½®"
- æ·»åŠ é’±åŒ…
- å¡«å†™é’±åŒ…åœ°å€å’Œç§é’¥

**4. é…ç½®èƒ½é‡ç§Ÿèµï¼ˆæ¨èï¼‰**
- è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "èƒ½é‡ç§Ÿèµ"
- é€‰æ‹© CatFee API æ¨¡å¼
- å¡«å†™ API Key

**5. é…ç½®é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰**
- è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "é‚®ä»¶é…ç½®"
- å¡«å†™ SMTP ä¿¡æ¯

---

## ğŸ“Š éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ MongoDB
sudo systemctl status mongod

# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ£€æŸ¥åç«¯æœåŠ¡
pm2 status

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E '(80|443|3000|27017)'
```

### 2. æµ‹è¯•è®¿é—®

```bash
# æµ‹è¯•å‰ç«¯
curl -I https://your-domain.com

# æµ‹è¯• API
curl https://your-domain.com/api/settings/public

# æµ‹è¯•æ”¯ä»˜å›è°ƒ
curl "https://your-domain.com/api/payments/notify?test=1"
```

### 3. æŸ¥çœ‹æ—¥å¿—

```bash
# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/easypay_access.log
sudo tail -f /var/log/nginx/easypay_error.log

# åç«¯æ—¥å¿—
pm2 logs easypay-backend

# MongoDB æ—¥å¿—
sudo tail -f /var/log/mongodb/mongod.log
```

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. MongoDB å®‰å…¨

```bash
# åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
mongosh

use admin
db.createUser({
  user: "easypay_admin",
  pwd: "your-secure-password",
  roles: [ { role: "readWrite", db: "easypay" } ]
})

exit

# å¯ç”¨è®¤è¯
sudo nano /etc/mongod.conf
```

**æ·»åŠ ï¼š**
```yaml
security:
  authorization: enabled
```

**é‡å¯ MongoDBï¼š**
```bash
sudo systemctl restart mongod
```

**æ›´æ–° .envï¼š**
```env
MONGODB_URI=mongodb://easypay_admin:your-secure-password@localhost:27017/easypay
```

### 2. é™åˆ¶ MongoDB è®¿é—®

```bash
sudo nano /etc/mongod.conf
```

**ç¡®ä¿åªç›‘å¬æœ¬åœ°ï¼š**
```yaml
net:
  bindIp: 127.0.0.1
```

### 3. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo nano /usr/local/bin/backup-easypay.sh
```

**å¤‡ä»½è„šæœ¬å†…å®¹ï¼š**
```bash
#!/bin/bash
BACKUP_DIR="/var/backups/easypay"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mongodump --db easypay --out $BACKUP_DIR/db_$DATE

# å¤‡ä»½ä»£ç å’Œé…ç½®
tar -czf $BACKUP_DIR/code_$DATE.tar.gz /var/www/easypay

# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -type f -mtime +30 -delete

echo "Backup completed: $DATE"
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š**
```bash
sudo chmod +x /usr/local/bin/backup-easypay.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ï¼‰
sudo crontab -e

# æ·»åŠ ï¼š
0 2 * * * /usr/local/bin/backup-easypay.sh >> /var/log/easypay-backup.log 2>&1
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°ä»£ç 

```bash
cd /var/www/easypay

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# å®‰è£…æ–°ä¾èµ–
npm install --production

# é‡æ–°æ„å»ºå‰ç«¯
npm run build

# é‡å¯åç«¯æœåŠ¡
pm2 restart easypay-backend

# é‡å¯ Nginx
sudo systemctl reload nginx
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ— æ³•è®¿é—®ç½‘ç«™

**æ£€æŸ¥ï¼š**
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/easypay_error.log
```

### é—®é¢˜ 2ï¼šAPI è¯·æ±‚å¤±è´¥

**æ£€æŸ¥ï¼š**
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
pm2 status
pm2 logs easypay-backend

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 3000
```

### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥ï¼š**
```bash
# æ£€æŸ¥ MongoDB çŠ¶æ€
sudo systemctl status mongod

# æµ‹è¯•è¿æ¥
mongosh

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/mongodb/mongod.log
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰
- [ ] æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡å®Œæˆ
- [ ] åŸŸåè§£æé…ç½®å®Œæˆ
- [ ] SSL è¯ä¹¦å‡†å¤‡å®Œæˆ
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥åˆ¶å®š

### éƒ¨ç½²ä¸­
- [ ] ä»£ç éƒ¨ç½²å®Œæˆ
- [ ] ä¾èµ–å®‰è£…å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] å‰ç«¯æ„å»ºå®Œæˆ
- [ ] Nginx é…ç½®å®Œæˆ
- [ ] åç«¯æœåŠ¡å¯åŠ¨å®Œæˆ

### éƒ¨ç½²å
- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ç®¡ç†åå°å¯ä»¥ç™»å½•
- [ ] API æ¥å£æ­£å¸¸å“åº”
- [ ] æ”¯ä»˜åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ä»£ä»˜åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] é‚®ä»¶é€šçŸ¥æµ‹è¯•é€šè¿‡
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] å¤‡ä»½ä»»åŠ¡é…ç½®å®Œæˆ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨æ—¥å¿—
2. Nginx æ—¥å¿—
3. PM2 æ—¥å¿—
4. MongoDB æ—¥å¿—

---

**éƒ¨ç½²æŒ‡å—ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-02  
**é€‚ç”¨ç³»ç»Ÿï¼š** Ubuntu 20.04+ / CentOS 7+
