# 登录问题 - 快速修复

## 问题
后端运行成功，但用户无法登录，提示"操作失败"。

## 原因
**Nginx 缺少 API 反向代理配置**，前端的 `/api/*` 请求无法到达后端。

---

## 修复步骤（3 分钟）

### 步骤 1：修改 Nginx 配置

1. 宝塔面板 → **网站** → `kk.vpno.eu.org` → **设置** → **配置文件**

2. 找到这一行：
   ```nginx
   #REWRITE-END
   ```

3. 在它**下面**添加：
   ```nginx
   # API 反向代理
   location /api/ {
       proxy_pass http://127.0.0.1:5000;
       proxy_http_version 1.1;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
   }
   
   # 前端路由支持
   location / {
       try_files $uri $uri/ /index.html;
   }
   ```

4. 点击 **保存**

5. 重载 Nginx（宝塔会提示）

---

### 步骤 2：重启后端

```bash
cd /www/wwwroot/kk.vpno.eu.org/easypay
pm2 restart easypay-backend
```

---

### 步骤 3：测试

#### 方法 1：命令行测试
```bash
# 测试 API 是否可访问
curl https://kk.vpno.eu.org/api/settings/public

# 测试登录
node server/scripts/testLogin.js
```

#### 方法 2：浏览器测试
1. 访问 `https://kk.vpno.eu.org`
2. 登录：
   - 邮箱：`kailsay@gmail.com`
   - 密码：`specter1234`
3. 应该能成功登录并看到"管理后台"按钮

---

## 验证成功标志

✅ 浏览器可以正常登录  
✅ 可以看到"管理后台"按钮  
✅ 可以访问个人中心  

---

## 如果还是不行

查看详细诊断指南：`登录问题修复指南.md`

或者运行诊断：
```bash
# 查看后端日志
pm2 logs easypay-backend --lines 50

# 查看 Nginx 错误日志
tail -f /www/wwwlogs/kk.vpno.eu.org.error.log
```
