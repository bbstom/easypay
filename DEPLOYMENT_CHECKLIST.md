# 🚀 部署检查清单

在将系统部署到生产环境之前，请确保完成以下所有检查项。

## 📋 配置检查

### 1. 环境变量 (.env)

- [ ] `MONGODB_URI` - MongoDB 连接字符串已配置
- [ ] `JWT_SECRET` - JWT 密钥已设置（建议使用强随机字符串）
- [ ] `TRON_PRIVATE_KEY` - TRON 钱包私钥已配置
- [ ] `TRON_API_URL` - TRON API 地址已设置（主网: https://api.trongrid.io）
- [ ] `NODE_ENV` - 设置为 `production`
- [ ] `PORT` - 服务器端口已配置

### 2. 数据库

- [ ] MongoDB 服务正常运行
- [ ] 数据库连接测试成功
- [ ] 创建了管理员账户（`npm run create-admin`）
- [ ] 数据库已配置备份策略

### 3. TRON 钱包

- [ ] 钱包已创建
- [ ] 私钥已安全备份
- [ ] 钱包已充值 TRX（建议 100+）
- [ ] 钱包已充值 USDT（根据业务量）
- [ ] 钱包连接测试成功（`npm run test-wallet`）

### 4. 支付网关

- [ ] 支付网关 API URL 已配置
- [ ] 商户 ID 已配置
- [ ] API 密钥已配置
- [ ] API 版本已选择（V1 或 V2）
- [ ] 回调 URL 已配置且可访问
- [ ] 支付网关测试成功

### 5. 邮件服务

- [ ] SMTP 服务器地址已配置
- [ ] SMTP 端口已配置
- [ ] SMTP 用户名和密码已配置
- [ ] 发件人信息已配置
- [ ] 邮件发送测试成功（`npm run test-email`）

## 🧪 功能测试

### 1. 基础功能

- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 管理员登录功能正常
- [ ] 页面导航正常

### 2. 支付流程

- [ ] 创建订单功能正常
- [ ] 支付网关跳转正常
- [ ] 支付回调接收正常
- [ ] 签名验证正常
- [ ] 订单状态更新正常

### 3. 转账功能

- [ ] 自动转账触发正常
- [ ] USDT 转账功能正常
- [ ] TRX 转账功能正常
- [ ] 交易哈希记录正常
- [ ] 转账状态更新正常

### 4. 重试机制

- [ ] 自动重试功能正常
- [ ] 手动重试功能正常
- [ ] 重试次数限制正常
- [ ] 失败状态标记正常

### 5. 监控功能

- [ ] 钱包余额显示正常
- [ ] 余额预警功能正常
- [ ] 订单统计正常
- [ ] 财务统计正常

### 6. 通知功能

- [ ] 订单完成邮件发送正常
- [ ] 邮件内容格式正确
- [ ] 邮件发送状态记录正常

## 🔒 安全检查

### 1. 私钥安全

- [ ] 私钥未提交到 Git
- [ ] `.env` 文件在 `.gitignore` 中
- [ ] 私钥已安全备份（离线存储）
- [ ] 使用专用钱包（不与个人资产混用）

### 2. API 安全

- [ ] 管理员接口需要身份验证
- [ ] JWT 密钥足够强
- [ ] 敏感信息不在日志中输出
- [ ] CORS 配置正确

### 3. 数据安全

- [ ] 密码使用 bcrypt 加密
- [ ] 数据库连接使用安全连接
- [ ] 敏感数据不在前端暴露

## 📊 监控和日志

### 1. 日志系统

- [ ] 服务器日志正常输出
- [ ] 错误日志记录完整
- [ ] 转账日志记录详细
- [ ] 日志文件定期清理

### 2. 监控指标

- [ ] 钱包余额监控
- [ ] 订单成功率监控
- [ ] 转账失败率监控
- [ ] 系统性能监控

### 3. 告警机制

- [ ] 余额不足告警
- [ ] 转账失败告警
- [ ] 系统异常告警

## 🔧 性能优化

### 1. 数据库优化

- [ ] 创建必要的索引
- [ ] 查询性能优化
- [ ] 连接池配置

### 2. 转账优化

- [ ] 考虑质押 TRX 获取能量
- [ ] 考虑使用能量租赁
- [ ] 批量处理策略（如需要）

### 3. 前端优化

- [ ] 生产构建完成
- [ ] 静态资源压缩
- [ ] CDN 配置（如需要）

## 📝 文档和备份

### 1. 文档

- [ ] 部署文档已准备
- [ ] 操作手册已准备
- [ ] 故障排查文档已准备
- [ ] API 文档已准备

### 2. 备份

- [ ] 数据库备份策略已制定
- [ ] 私钥已安全备份
- [ ] 配置文件已备份
- [ ] 代码已备份到 Git

## 🚀 部署步骤

### 1. 服务器准备

- [ ] 服务器已准备（云服务器/VPS）
- [ ] Node.js 已安装（建议 v18+）
- [ ] MongoDB 已安装并运行
- [ ] 防火墙已配置
- [ ] 域名已解析（如需要）

### 2. 代码部署

- [ ] 代码已上传到服务器
- [ ] 依赖已安装（`npm install --production`）
- [ ] 环境变量已配置
- [ ] 前端已构建（`npm run build`）

### 3. 服务启动

- [ ] 后端服务已启动
- [ ] 使用 PM2 或类似工具管理进程
- [ ] 服务自动重启已配置
- [ ] 日志输出已配置

### 4. 反向代理（如使用）

- [ ] Nginx/Apache 已配置
- [ ] SSL 证书已安装
- [ ] HTTPS 已启用
- [ ] 静态文件服务已配置

## ✅ 上线前最终检查

### 1. 功能验证

- [ ] 完整支付流程测试（小额）
- [ ] 转账功能测试（小额）
- [ ] 管理后台功能测试
- [ ] 邮件通知测试

### 2. 性能验证

- [ ] 页面加载速度正常
- [ ] API 响应速度正常
- [ ] 数据库查询性能正常

### 3. 安全验证

- [ ] 所有敏感信息已保护
- [ ] 管理员权限验证正常
- [ ] 支付回调签名验证正常

### 4. 监控验证

- [ ] 钱包余额监控正常
- [ ] 日志记录正常
- [ ] 告警机制正常

## 📞 应急预案

### 1. 联系方式

- [ ] 技术支持联系方式已准备
- [ ] 支付网关客服联系方式已准备
- [ ] 服务器提供商联系方式已准备

### 2. 应急措施

- [ ] 系统故障应急方案已准备
- [ ] 转账失败处理流程已准备
- [ ] 数据恢复方案已准备

### 3. 回滚计划

- [ ] 代码回滚方案已准备
- [ ] 数据库回滚方案已准备
- [ ] 配置回滚方案已准备

## 🎯 上线后监控（前3天）

### 第1天

- [ ] 每小时检查钱包余额
- [ ] 每小时检查订单状态
- [ ] 监控转账成功率
- [ ] 检查错误日志

### 第2-3天

- [ ] 每4小时检查系统状态
- [ ] 监控订单量和成功率
- [ ] 检查用户反馈
- [ ] 优化发现的问题

### 持续监控

- [ ] 每日检查钱包余额
- [ ] 每日查看失败订单
- [ ] 每周查看统计数据
- [ ] 每月进行系统优化

## 📈 优化建议

### 短期（1-2周）

- [ ] 收集用户反馈
- [ ] 优化用户体验
- [ ] 修复发现的 bug
- [ ] 调整系统参数

### 中期（1-2月）

- [ ] 实现余额自动告警
- [ ] 添加更多统计功能
- [ ] 优化转账手续费
- [ ] 实现批量处理

### 长期（3-6月）

- [ ] 多签钱包支持
- [ ] 冷热钱包分离
- [ ] 自动化对账系统
- [ ] 风控系统

## ✅ 检查清单完成

当所有检查项都完成后：

1. ✅ 系统已准备好部署
2. ✅ 所有功能已测试
3. ✅ 安全措施已到位
4. ✅ 监控系统已就绪
5. ✅ 应急预案已准备

**恭喜！您可以开始部署了！** 🎉

---

**重要提示**：
- 建议先在测试环境完整测试
- 主网上线先用小额测试
- 密切监控前3天的运行情况
- 保持技术支持随时待命
