# 支付流程说明

## 用户操作流程

1. **填写代付信息**
   - 输入波场地址（T开头）
   - 输入代付数量（1-200）
   - 输入通知邮箱（可选）
   - 选择支付方式（支付宝/微信）

2. **提交订单**
   - 点击"立即发起代付"按钮
   - 系统创建订单并调用支付平台API
   - 自动弹出支付二维码弹窗

3. **完成支付**
   - 使用支付宝或微信扫描二维码
   - 完成支付
   - 系统每3秒自动查询订单状态

4. **自动代付**
   - 支付成功后，系统自动执行USDT/TRX代付
   - 2-10分钟内到账
   - 如果填写了邮箱，会收到完成通知邮件

5. **查看记录**
   - 在"历史订单"表格中查看交易状态
   - 点击哈希值可跳转到区块链浏览器查看

## 技术实现

### 前端 (PayPage.jsx)
- 添加支付方式选择（支付宝/微信）
- 支付二维码弹窗组件
- 订单状态轮询（每3秒查询一次，最多5分钟）
- 二维码生成使用 qrserver.com API

### 后端 (server/routes/payments.js)
- 接收支付方式参数 (paymentMethod)
- 调用支付平台API创建订单
- 返回支付链接 (paymentUrl)
- 支付回调处理
- 自动执行代付
- 发送邮件通知

### 支付平台集成
- API文档: https://pay.abcdely.top/doc/index.html
- 创建订单接口
- 签名验证
- 回调通知

## 配置要求

### 系统设置（后台配置）
1. **支付平台配置**
   - 支付API地址
   - 商户ID
   - API密钥
   - 回调地址

2. **TRON配置**
   - TRON API地址
   - 钱包私钥

3. **SMTP配置（可选）**
   - SMTP服务器
   - SMTP端口
   - SMTP用户名/密码
   - 发件人信息

## 测试步骤

1. 启动开发服务器
   ```bash
   npm run dev
   ```

2. 访问代付页面
   - 填写测试地址和金额
   - 选择支付方式
   - 提交订单

3. 查看支付二维码
   - 确认订单信息
   - 扫码支付或打开支付页面

4. 等待支付完成
   - 系统自动轮询订单状态
   - 支付成功后自动关闭弹窗

5. 查看历史订单
   - 确认订单状态为 SUCCESS
   - 点击哈希值查看链上交易

## 注意事项

- 支付二维码有效期通常为15分钟
- 订单状态轮询最多持续5分钟
- 代付到账时间为2-10分钟
- 邮件通知需要配置SMTP
- 测试环境建议使用小额测试
